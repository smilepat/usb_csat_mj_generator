# μλ¥ μμ–΄ λ¬Έν•­ μƒμ„±-κ²€μ¦ μ‹μ¤ν… μ‚¬μ©μ κ°€μ΄λ“

## λ©μ°¨
1. [μ‹μ¤ν… κ°μ”](#1-μ‹μ¤ν…-κ°μ”)
2. [μ‹μ¤ν… κµ¬μ„± λ° μ•„ν‚¤ν…μ²](#2-μ‹μ¤ν…-κµ¬μ„±-λ°-μ•„ν‚¤ν…μ²)
3. [μ‘λ™ μ›λ¦¬](#3-μ‘λ™-μ›λ¦¬)
4. [λ©”λ‰΄λ³„ μƒμ„Έ κ°€μ΄λ“](#4-λ©”λ‰΄λ³„-μƒμ„Έ-κ°€μ΄λ“)
5. [ν”„λ΅¬ν”„νΈ κ΄€λ¦¬ λ° κ°μ„ ](#5-ν”„λ΅¬ν”„νΈ-κ΄€λ¦¬-λ°-κ°μ„ )
6. [λ¬Έν•­ μƒμ„± λ° κ°μ„ ](#6-λ¬Έν•­-μƒμ„±-λ°-κ°μ„ )
7. [Metrics ν™μ©λ²•](#7-metrics-ν™μ©λ²•)
8. [νμ¤ν† λ¦¬ λ° λ²„μ „ κ΄€λ¦¬](#8-νμ¤ν† λ¦¬-λ°-λ²„μ „-κ΄€λ¦¬)
9. [κ³ κΈ‰ κΈ°λ¥](#9-κ³ κΈ‰-κΈ°λ¥)
10. [API λ νΌλ°μ¤](#10-api-λ νΌλ°μ¤)

---

## 1. μ‹μ¤ν… κ°μ”

### 1.1 μ•± μ •λ³΄
- **μ•± μ΄λ¦„**: KSAT Item Generator & Validator (μλ¥ λ¬Έν•­ μƒμ„±-κ²€μ¦ μ‹μ¤ν…)
- **λ©μ **: ν•κµ­ μλ¥ μμ–΄ μμ—­ λ¬Έν•­μ„ AI(LLM)λ¥Ό ν™μ©ν•μ—¬ μλ™ μƒμ„±ν•κ³ , ν’μ§μ„ κ²€μ¦ν•λ” μ‹μ¤ν…
- **μ ‘μ† URL**:
  - ν”„λ΅ νΈμ—”λ“: `http://localhost:3000`
  - λ°±μ—”λ“ API: `http://localhost:3001`

### 1.2 μ£Όμ” κΈ°λ¥
| κΈ°λ¥ | μ„¤λ… |
|------|------|
| ν”„λ΅¬ν”„νΈ κ΄€λ¦¬ | λ¬Έν•­ μƒμ„±μ© ν”„λ΅¬ν”„νΈ μ‘μ„±, μμ •, λ²„μ „ κ΄€λ¦¬ |
| λ¬Έν•­ μƒμ„± | AIλ¥Ό ν™μ©ν• μλ¥ ν•μ‹ λ¬Έν•­ μλ™ μƒμ„± |
| 3κ²Ή κ²€μ¦ | κµ¬μ΅°/λ‚΄μ©/μλ¥μ ν•©μ„± λ‹¤μΈµ κ²€μ¦ μ‹μ¤ν… |
| λ©”νΈλ¦­μ¤ λ¶„μ„ | ν”„λ΅¬ν”„νΈ λ° λ¬Έν•­ ν’μ§ μμΉν™” |
| μλ™ κ°μ„  | μ„±λ¥ μ €ν• μ‹ μλ™ ν”„λ΅¬ν”„νΈ κ°μ„  |
| A/B ν…μ¤ν… | ν”„λ΅¬ν”„νΈ λ²„μ „ κ°„ μ„±λ¥ λΉ„κµ |
| ν”Όλ“λ°± μμ§‘ | μ²΄κ³„μ μΈ ν”Όλ“λ°± κ΄€λ¦¬ λ° μ μ© |

---

## 2. μ‹μ¤ν… κµ¬μ„± λ° μ•„ν‚¤ν…μ²

### 2.1 κΈ°μ  μ¤νƒ
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                      Frontend (React)                        β”‚
β”‚                    http://localhost:3000                     β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                    Backend (Express.js)                      β”‚
β”‚                    http://localhost:3001                     β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                    Database (SQLite/SQL.js)                  β”‚
β”‚                    ./data/csat.db                            β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                    LLM Provider                              β”‚
β”‚              Gemini API / OpenAI API (μ„ νƒ)                   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 2.2 λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°

#### ν•µμ‹¬ ν…μ΄λΈ”
| ν…μ΄λΈ”λ… | μ©λ„ |
|----------|------|
| `prompts` | ν”„λ΅¬ν”„νΈ μ €μ¥ (ν‚¤, μ λ©, λ³Έλ¬Έ, μƒνƒ) |
| `prompt_versions` | ν”„λ΅¬ν”„νΈ λ²„μ „ νμ¤ν† λ¦¬ |
| `prompt_metrics` | ν”„λ΅¬ν”„νΈ ν’μ§ λ©”νΈλ¦­μ¤ |
| `prompt_feedback` | ν”„λ΅¬ν”„νΈ ν”Όλ“λ°± μμ§‘ |
| `item_requests` | λ¬Έν•­ μƒμ„± μ”μ²­ |
| `item_json` | μƒμ„±λ λ¬Έν•­ JSON μ €μ¥ |
| `item_output` | μ •κ·ν™”λ λ¬Έν•­ μ¶λ ¥ |
| `item_metrics` | λ¬Έν•­ ν’μ§ λ©”νΈλ¦­μ¤ (3κ²Ή κ²€μ¦) |
| `item_generation_history` | μƒμ„± μ‹λ„λ³„ νμ¤ν† λ¦¬ |
| `ab_tests` | A/B ν…μ¤νΈ κ΄€λ¦¬ |
| `config` | μ‹μ¤ν… μ„¤μ • |
| `logs` | μ‹μ¤ν… λ΅κ·Έ |
| `errors` | μ—λ¬ λ΅κ·Έ |

### 2.3 ν”„λ΅μ νΈ κµ¬μ΅°
```
web-app/
β”β”€β”€ server/                    # λ°±μ—”λ“
β”‚   β”β”€β”€ index.js              # μ„λ²„ μ—”νΈλ¦¬ν¬μΈνΈ
β”‚   β”β”€β”€ db/
β”‚   β”‚   β””β”€β”€ database.js       # DB μ΄κΈ°ν™” λ° μ¤ν‚¤λ§
β”‚   β”β”€β”€ routes/
β”‚   β”‚   β”β”€β”€ prompts.js        # ν”„λ΅¬ν”„νΈ API
β”‚   β”‚   β”β”€β”€ items.js          # λ¬Έν•­ API
β”‚   β”‚   β”β”€β”€ sets.js           # μ„ΈνΈ λ¬Έν•­ API
β”‚   β”‚   β”β”€β”€ config.js         # μ„¤μ • API
β”‚   β”‚   β””β”€β”€ logs.js           # λ΅κ·Έ API
β”‚   β””β”€β”€ services/
β”‚       β”β”€β”€ llmClient.js      # LLM νΈμ¶
β”‚       β”β”€β”€ itemPipeline.js   # λ¬Έν•­ μƒμ„± νμ΄ν”„λΌμΈ
β”‚       β”β”€β”€ promptBuilder.js  # ν”„λ΅¬ν”„νΈ μ΅°ν•©
β”‚       β”β”€β”€ promptEvaluator.js# ν”„λ΅¬ν”„νΈ ν‰κ°€
β”‚       β”β”€β”€ autoImproveService.js  # μλ™ κ°μ„ 
β”‚       β”β”€β”€ abTestingService.js    # A/B ν…μ¤ν…
β”‚       β”β”€β”€ metricsService.js # λ¬Έν•­ λ©”νΈλ¦­μ¤
β”‚       β”β”€β”€ promptMetricsService.js # ν”„λ΅¬ν”„νΈ λ©”νΈλ¦­μ¤
β”‚       β””β”€β”€ validators.js     # κ²€μ¦ λ΅μ§
β”β”€β”€ client/                    # ν”„λ΅ νΈμ—”λ“
β”‚   β””β”€β”€ src/
β”‚       β”β”€β”€ pages/            # νμ΄μ§€ μ»΄ν¬λ„νΈ
β”‚       β”β”€β”€ api.js            # API ν΄λΌμ΄μ–ΈνΈ
β”‚       β””β”€β”€ utils/            # μ ν‹Έλ¦¬ν‹°
β””β”€β”€ data/
    β””β”€β”€ csat.db               # SQLite λ°μ΄ν„°λ² μ΄μ¤
```

---

## 3. μ‘λ™ μ›λ¦¬

### 3.1 λ¬Έν•­ μƒμ„± νλ¦„

```
[μ‚¬μ©μ μ”μ²­] β†’ [ν”„λ΅¬ν”„νΈ μ΅°ν•©] β†’ [LLM νΈμ¶] β†’ [JSON νμ‹±] β†’ [3κ²Ή κ²€μ¦] β†’ [κ²°κ³Ό μ €μ¥]
     β”‚              β”‚               β”‚              β”‚              β”‚
     β–Ό              β–Ό               β–Ό              β–Ό              β–Ό
  λ¬Έν•­λ²νΈ      MASTER_PROMPT    Gemini/       parseItemJson  Layer1: κµ¬μ΅°
  λ‚μ΄λ„        + μ ν•λ³„ ν”„λ΅¬ν”„νΈ   OpenAI        normalize     Layer2: λ‚΄μ©
  μ£Όμ  λ“±                                                      Layer3: μλ¥μ ν•©μ„±
```

### 3.2 μƒμ„Έ λ‹¨κ³„

#### Step 1: μ”μ²­ μƒμ„±
```javascript
// μ‚¬μ©μκ°€ λ¬Έν•­ μƒμ„± μ”μ²­
{
  item_no: 29,        // λ¬Έν•­ λ²νΈ (RC29 = μ–΄λ²•)
  level: "μ¤‘",        // λ‚μ΄λ„
  topic: "ν™κ²½",      // μ£Όμ  (μ„ νƒ)
  prompt_id: 221      // μ‚¬μ©ν•  ν”„λ΅¬ν”„νΈ ID
}
```

#### Step 2: ν”„λ΅¬ν”„νΈ λ²λ“¤ κµ¬μ„±
```
MASTER_PROMPT (κ³µν†µ μ§€μΉ¨)
    +
μ ν•λ³„ ν”„λ΅¬ν”„νΈ (RC29 μ–΄λ²• μ§€μΉ¨)
    +
μ‚¬μ©μ μ…λ ¥ (λ‚μ΄λ„, μ£Όμ  λ“±)
    β†“
μµμΆ… ν”„λ΅¬ν”„νΈ λ²λ“¤
```

#### Step 3: LLM νΈμ¶ λ° νμ‹±
- Gemini λλ” OpenAI API νΈμ¶
- JSON μ‘λ‹µ νμ‹± λ° μ •κ·ν™”
- μµλ€ 3ν μ¬μ‹λ„ (MAX_RETRY μ„¤μ •)

#### Step 4: 3κ²Ή κ²€μ¦ μ‹μ¤ν…
| Layer | κ²€μ¦ λ‚΄μ© | μ μ λ²”μ„ |
|-------|----------|----------|
| Layer 1 | κµ¬μ΅° κ²€μ¦ (ν•„λ“ μ΅΄μ¬, νƒ€μ… μ²΄ν¬) | 0-100 |
| Layer 2 | λ‚΄μ© ν’μ§ (μ •λ‹µ μ ν¨μ„±, μ¤λ‹µ λ³€λ³„λ ¥) | 0-100 |
| Layer 3 | μλ¥ μ ν•©μ„± (λ‹¨μ–΄μ, λ¬Έμ¥ κµ¬μ΅°, ν•μ‹) | 0-100 |

#### Step 5: κ²°κ³Ό μ €μ¥
- `item_json`: μ›λ³Έ λ° μ •κ·ν™”λ JSON
- `item_output`: μµμΆ… λ¬Έν•­ μ¶λ ¥ ν•νƒ
- `item_metrics`: ν’μ§ λ©”νΈλ¦­μ¤
- `item_generation_history`: μ‹λ„λ³„ νμ¤ν† λ¦¬

---

## 4. λ©”λ‰΄λ³„ μƒμ„Έ κ°€μ΄λ“

### 4.1 λ€μ‹λ³΄λ“ (Dashboard)

**κ²½λ΅**: `/` λλ” `/dashboard`

#### μ£Όμ” κΈ°λ¥
1. **μ‹μ¤ν… ν„ν™© μ”μ•½**
   - μ „μ²΄ λ¬Έν•­ μ
   - μ„±κ³µ/μ‹¤ν¨ λΉ„μ¨
   - μµκ·Ό μƒμ„± λ¬Έν•­

2. **ν”„λ΅¬ν”„νΈ ν„ν™©**
   - μ΄ ν”„λ΅¬ν”„νΈ μ
   - κ°μ„  ν•„μ” ν”„λ΅¬ν”„νΈ μ•λ¦Ό
   - μ„±λ¥ λ“±κΈ‰ λ¶„ν¬

3. **λΉ λ¥Έ μ‘μ—…**
   - μƒ λ¬Έν•­ μƒμ„± λ°”λ΅κ°€κΈ°
   - ν”„λ΅¬ν”„νΈ κ΄€λ¦¬ λ°”λ΅κ°€κΈ°

#### ν‘μ‹ μ •λ³΄
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  π“ λ€μ‹λ³΄λ“                                             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  [μ „μ²΄ λ¬Έν•­]    [μ„±κ³µ]    [μ‹¤ν¨]    [λ€κΈ°μ¤‘]              β”‚
β”‚     150         120        25         5                 β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  μµκ·Ό μƒμ„± λ¬Έν•­                                          β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ ID        β”‚ μ ν•  β”‚ μƒνƒ β”‚ μƒμ„±μΌ                β”‚   β”‚
β”‚  β”‚ abc12345  β”‚ RC29  β”‚ β“OK β”‚ 2026-01-04 15:30     β”‚   β”‚
β”‚  β”‚ def67890  β”‚ RC31  β”‚ β—FAILβ”‚ 2026-01-04 15:25    β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 4.2 λ¬Έν•­ μƒμ„± (Generate)

**κ²½λ΅**: `/generate`

#### μ‚¬μ© λ°©λ²•

1. **λ¬Έν•­ μ ν• μ„ νƒ**
   | λ²νΈ | μ ν• | μ„¤λ… |
   |------|------|------|
   | 18 | λ©μ  | κΈ€μ λ©μ  νμ•… |
   | 19 | μ‹¬κ²½ | μ‹¬κ²½/λ¶„μ„κΈ° νμ•… |
   | 20 | μ£Όμ¥ | ν•„μμ μ£Όμ¥ |
   | 21 | ν•¨μ | λ°‘μ¤„ μΉ λ¶€λ¶„μ μλ―Έ |
   | 22 | μ”μ§€ | κΈ€μ μ”μ§€ |
   | 23 | μ£Όμ  | κΈ€μ μ£Όμ  |
   | 24 | μ λ© | κΈ€μ μ λ© |
   | 25 | λ„ν‘ | λ„ν‘ μ΄ν•΄ |
   | 26-28 | λ‚΄μ©μΌμΉ | λ‚΄μ© μΌμΉ/λ¶μΌμΉ |
   | 29 | μ–΄λ²• | μ–΄λ²• μ •ν™•μ„± |
   | 30 | μ–΄ν | μ–΄ν μ μ μ„± |
   | 31-34 | λΉμΉΈ | λΉμΉΈ μ¶”λ΅  |
   | 35 | νλ¦„λ¬΄κ΄€ | νλ¦„κ³Ό λ¬΄κ΄€ν• λ¬Έμ¥ |
   | 36-37 | μμ„ | κΈ€μ μμ„ |
   | 38-39 | λ¬Έμ¥μ‚½μ… | μ£Όμ–΄μ§„ λ¬Έμ¥ λ„£κΈ° |
   | 40 | μ”μ•½λ¬Έ | μ”μ•½λ¬Έ μ™„μ„± |
   | 41-42 | μ¥λ¬Έ1 | μ¥λ¬Έ λ…ν•΄ (μ λ©+μ–΄ν) |
   | 43-45 | μ¥λ¬Έ2 | μ¥λ¬Έ λ…ν•΄ (μμ„+μ‚½μ…+λ‚΄μ©) |

2. **μµμ… μ„¤μ •**
   ```
   λ‚μ΄λ„: [μ‰¬μ›€] [μ¤‘κ°„] [μ–΄λ ¤μ›€]
   μ£Όμ : [μμ μ…λ ¥ λλ” μ„ νƒ]
   ν”„λ΅¬ν”„νΈ: [κΈ°λ³Έκ°’ μ‚¬μ©] λλ” [μ§μ ‘ μ„ νƒ]
   ```

3. **μƒμ„± μ‹¤ν–‰**
   - "μƒμ„±" λ²„νΌ ν΄λ¦­
   - μ§„ν–‰ μƒνƒ μ‹¤μ‹κ°„ ν‘μ‹
   - μ™„λ£ μ‹ κ²°κ³Ό λ° λ©”νΈλ¦­μ¤ ν‘μ‹

#### μƒμ„± κ²°κ³Ό ν™”λ©΄
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  β“ λ¬Έν•­ μƒμ„± μ™„λ£                                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  [μ§€λ¬Έ]                                                  β”‚
β”‚  The concept of sustainable development...               β”‚
β”‚                                                          β”‚
β”‚  [λ°λ¬Έ]                                                  β”‚
β”‚  λ‹¤μ κΈ€μ λ°‘μ¤„ μΉ λ¶€λ¶„ μ¤‘, μ–΄λ²•μƒ ν‹€λ¦° κ²ƒμ€?            β”‚
β”‚                                                          β”‚
β”‚  [μ„ νƒμ§€]                                                β”‚
β”‚  β‘  which β†’ that                                          β”‚
β”‚  β‘΅ growing β†’ grown                                       β”‚
β”‚  β‘Ά has been β†’ have been  β† μ •λ‹µ                         β”‚
β”‚  β‘£ to reduce β†’ reducing                                  β”‚
β”‚  β‘¤ what β†’ that                                          β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  [λ©”νΈλ¦­μ¤]                                              β”‚
β”‚  Layer 1 (κµ¬μ΅°): 95μ  β“                                  β”‚
β”‚  Layer 2 (λ‚΄μ©): 82μ  β“                                  β”‚
β”‚  Layer 3 (μλ¥μ ν•©μ„±): 88μ  β“                            β”‚
β”‚  μµμΆ… μ μ: 88.3μ  (Bλ“±κΈ‰)                               β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 4.3 λ¬Έν•­ μ”μ²­ λ©λ΅ (Item Requests)

**κ²½λ΅**: `/requests`

#### κΈ°λ¥
1. **μ”μ²­ λ©λ΅ μ΅°ν**
   - μƒνƒλ³„ ν•„ν„°λ§ (PENDING, RUNNING, OK, FAIL)
   - μ„ΈνΈλ³„ ν•„ν„°λ§
   - νμ΄μ§€λ„¤μ΄μ…

2. **μƒμ„Έ μ •λ³΄ λ³΄κΈ°**
   - μ”μ²­ μ •λ³΄
   - μƒμ„± κ²°κ³Ό
   - λ©”νΈλ¦­μ¤ μƒμ„Έ
   - μ‹λ„λ³„ νμ¤ν† λ¦¬

3. **μ‘μ—… μν–‰**
   - κ°λ³„ λ¬Έν•­ μ¬μƒμ„±
   - μ”μ²­ μ‚­μ 
   - μΌκ΄„ μ²λ¦¬

#### μƒνƒ μ„¤λ…
| μƒνƒ | λ°°μ§€ μƒ‰μƒ | μ„¤λ… |
|------|----------|------|
| PENDING | λ…Έλ‘ | λ€κΈ° μ¤‘ |
| RUNNING | νλ‘ | μƒμ„± μ§„ν–‰ μ¤‘ |
| OK | μ΄λ΅ | μ„±κ³µ |
| FAIL | λΉ¨κ°• | μ‹¤ν¨ |

### 4.4 ν”„λ΅¬ν”„νΈ κ΄€λ¦¬ (Prompts)

**κ²½λ΅**: `/prompts`

#### ν”„λ΅¬ν”„νΈ λ©λ΅
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  π“ ν”„λ΅¬ν”„νΈ κ΄€λ¦¬                                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  ν‚¤          β”‚ μ λ©         β”‚ μ μ  β”‚ λ“±κΈ‰ β”‚ μƒνƒ      β”‚
β”‚  β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”‚
β”‚  MASTER_PROMPTβ”‚ λ§μ¤ν„° ν”„λ΅¬ν”„νΈβ”‚ 85   β”‚ B   β”‚ approved  β”‚
β”‚  PASSAGE_MASTERβ”‚μ§€λ¬Έ μƒμ„± λ§μ¤ν„°β”‚ 78   β”‚ C   β”‚ testing   β”‚
β”‚  29          β”‚ RC29 μ–΄λ²•    β”‚ 92   β”‚ A   β”‚ approved  β”‚
β”‚  31          β”‚ RC31 λΉμΉΈ    β”‚ 88   β”‚ B   β”‚ approved  β”‚
β”‚  ...                                                    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### ν”„λ΅¬ν”„νΈ μƒμ„Έ/νΈμ§‘
- ν”„λ΅¬ν”„νΈ ν…μ¤νΈ νΈμ§‘
- λ²„μ „ νμ¤ν† λ¦¬ μ΅°ν
- μ΄μ „ λ²„μ „ λ³µμ›
- λ©”νΈλ¦­μ¤ μ΅°ν
- AI ν‰κ°€ μ‹¤ν–‰
- ν”Όλ“λ°± κΈ°λ° κ°μ„ 

### 4.5 μ„¤μ • (Settings)

**κ²½λ΅**: `/settings`

#### μ„¤μ • ν•­λ©
| ν‚¤ | μ„¤λ… | κΈ°λ³Έκ°’ |
|----|------|-------|
| PROVIDER | LLM μ κ³µμ | gemini |
| GEMINI_MODEL | Gemini λ¨λΈλ… | gemini-2.5-pro |
| OPENAI_MODEL | OpenAI λ¨λΈλ… | gpt-4.1-mini |
| TEMP_BASE | κΈ°λ³Έ temperature | 0.4 |
| TEMP_HIGH | λ†’μ€ temperature | 0.7 |
| MAX_RETRY | μµλ€ μ¬μ‹λ„ νμ | 3 |
| TIMEOUT_MS | API νƒ€μ„μ•„μ›ƒ (ms) | 60000 |
| LOG_LEVEL | λ΅κ·Έ λ λ²¨ | INFO |

### 4.6 λ΅κ·Έ (Logs)

**κ²½λ΅**: `/logs`

#### νƒ­ κµ¬μ„±
1. **μΌλ° λ΅κ·Έ**
   - INFO, WARN, ERROR λ λ²¨λ³„ ν•„ν„°
   - νƒκ·Έ, μ”μ²­ IDλ΅ κ²€μƒ‰

2. **μ—λ¬ λ΅κ·Έ**
   - μ—λ¬ λ©”μ‹μ§€ μƒμ„Έ
   - μ¤νƒ νΈλ μ΄μ¤ ν™•μΈ

#### λ΅κ·Έ κ΄€λ¦¬
- μ¤λλ λ΅κ·Έ μ‚­μ  (NμΌ μ΄μ „)
- λ΅κ·Έ ν†µκ³„ ν™•μΈ

---

## 5. ν”„λ΅¬ν”„νΈ κ΄€λ¦¬ λ° κ°μ„ 

### 5.1 ν”„λ΅¬ν”„νΈ κµ¬μ΅°

#### ν”„λ΅¬ν”„νΈ ν‚¤ κ·μΉ™
| ν¨ν„΄ | μμ‹ | μ©λ„ |
|------|------|------|
| MASTER_PROMPT | - | λ¨λ“  λ¬Έν•­ κ³µν†µ μ§€μΉ¨ |
| PASSAGE_MASTER | - | μ§€λ¬Έ μƒμ„± κ³µν†µ μ§€μΉ¨ |
| μ«μ | 29, 31 | λ¬Έν•­ μ ν•λ³„ ν”„λ΅¬ν”„νΈ |
| RCμ«μ | RC29, RC31 | λ…ν•΄ λ¬Έν•­ (=μ«μμ™€ λ™μΌ) |
| LCμ«μ | LC01~LC17 | λ“£κΈ° λ¬Έν•­ |
| Pμ«μ | P29, P31 | μ§€λ¬Έ μƒμ„± ν”„λ΅¬ν”„νΈ |

#### ν”„λ΅¬ν”„νΈ μ΅°ν•© κ·μΉ™
```
μµμΆ… ν”„λ΅¬ν”„νΈ = MASTER_PROMPT + μ ν•λ³„ ν”„λ΅¬ν”„νΈ + μ‚¬μ©μ μ…λ ¥

μ) RC29 λ¬Έν•­ μƒμ„± μ‹:
1. MASTER_PROMPT (JSON ν•μ‹, μλ¥ μ›μΉ™ λ“±)
2. "29" ν”„λ΅¬ν”„νΈ (μ–΄λ²• λ¬Έν•­ μ§€μΉ¨)
3. μ‚¬μ©μ μ…λ ¥ (λ‚μ΄λ„: μ¤‘, μ£Όμ : ν™κ²½)
```

### 5.2 ν”„λ΅¬ν”„νΈ μ‘μ„± κ°€μ΄λ“

#### μΆ‹μ€ ν”„λ΅¬ν”„νΈμ μ΅°κ±΄
1. **λ…ν™•ν• JSON μ¶λ ¥ ν•μ‹ μ§€μ •**
   ```
   λ°λ“μ‹ λ‹¤μ JSON ν•μ‹μΌλ΅ μ¶λ ¥ν•μ„Έμ”:
   {
     "itemNo": λ¬Έν•­λ²νΈ,
     "passage": "μ§€λ¬Έ",
     "question": "λ°λ¬Έ",
     "options": ["β‘ ", "β‘΅", "β‘Ά", "β‘£", "β‘¤"],
     "answer": "μ •λ‹µλ²νΈ(1-5)",
     "explanation": "ν•΄μ„¤"
   }
   ```

2. **μλ¥ ν•μ‹ μ¤€μ μ§€μ‹**
   ```
   - μ§€λ¬Έ κΈΈμ΄: 150-200λ‹¨μ–΄
   - μ„ νƒμ§€: 5κ° ν•„μ
   - μ •λ‹µ κ·Όκ±°κ°€ μ§€λ¬Έμ— λ…ν™•ν μ΅΄μ¬ν•΄μ•Ό ν•¨
   ```

3. **κµ¬μ²΄μ μΈ μμ‹ ν¬ν•¨**
   ```
   [μμ‹]
   passage: "The concept of..."
   question: "λ‹¤μ κΈ€μ λ°‘μ¤„ μΉ λ¶€λ¶„ μ¤‘, μ–΄λ²•μƒ ν‹€λ¦° κ²ƒμ€?"
   ```

### 5.3 ν”„λ΅¬ν”„νΈ ν‰κ°€ μ‹μ¤ν…

#### κ·μΉ™ κΈ°λ° κ²€μ¦ (λΉ λ¥Έ κ²€μ¦)
```javascript
// API: POST /api/prompts/:key/quick-validate
{
  "passed": true/false,
  "promptType": "ITEM_PROMPT",
  "issues": [],      // μ‹¬κ°ν• λ¬Έμ 
  "warnings": []     // κ²½κ³ 
}
```

κ²€μ¦ ν•­λ©:
- JSON ν‚¤μ›λ“ ν¬ν•¨ μ—¬λ¶€
- μ„ νƒμ§€ 5κ° μ§€μ‹ μ—¬λ¶€
- κΈμ§€μ–΄ μ‚¬μ© μ—¬λ¶€
- λ¬Έν•­ μ ν•λ³„ ν•„μ ν‚¤μ›λ“

#### AI κΈ°λ° ν‰κ°€ (μƒμ„Έ ν‰κ°€)
```javascript
// API: POST /api/prompts/:key/evaluate
{
  "overall_score": 8.5,
  "criteria": {
    "clarity": 9,        // λ…ν™•μ„±
    "completeness": 8,   // μ™„μ „μ„±
    "consistency": 8,    // μΌκ΄€μ„±
    "specificity": 9,    // κµ¬μ²΄μ„±
    "csat_fit": 8        // μλ¥ μ ν•©μ„±
  },
  "strengths": ["λ…ν™•ν• ν•μ‹ μ§€μ‹", "κµ¬μ²΄μ μΈ μμ‹"],
  "weaknesses": ["μ¤λ‹µ λ§¤λ ¥λ„ μ§€μΉ¨ λ¶€μ΅±"],
  "suggestions": ["μ¤λ‹µ μ‘μ„± κ°€μ΄λ“λΌμΈ μ¶”κ°€ κ¶μ¥"]
}
```

### 5.4 ν”„λ΅¬ν”„νΈ κ°μ„  λ°©λ²•

#### λ°©λ²• 1: μλ™ νΈμ§‘
1. ν”„λ΅¬ν”„νΈ λ©λ΅μ—μ„ λ€μƒ μ„ νƒ
2. "νΈμ§‘" λ²„νΌ ν΄λ¦­
3. ν…μ¤νΈ μμ •
4. λ³€κ²½ μ‚¬μ  μ…λ ¥
5. "μ €μ¥" ν΄λ¦­

#### λ°©λ²• 2: AI κΈ°λ° μλ™ κ°μ„ 
```javascript
// API: POST /api/prompts/:key/improve
{
  "feedback": "μ¤λ‹µ λ§¤λ ¥λ„λ¥Ό λ†’μ΄λ” μ§€μΉ¨μ„ μ¶”κ°€ν•΄μ£Όμ„Έμ”"
}

// μ‘λ‹µ
{
  "improved_prompt": "κ°μ„ λ ν”„λ΅¬ν”„νΈ ν…μ¤νΈ...",
  "changes_made": ["μ¤λ‹µ μ‘μ„± κ°€μ΄λ“λΌμΈ μ¶”κ°€", "μμ‹ λ³΄κ°•"],
  "notes": "μ¤λ‹µ λ§¤λ ¥λ„ ν–¥μƒμ„ μ„ν• μ§€μΉ¨ μ¶”κ°€λ¨"
}
```

#### λ°©λ²• 3: μλ™ μν™ κ°μ„ 
μ„±λ¥ μ €ν• κ°μ§€ μ‹ μλ™ κ°μ„  νΈλ¦¬κ±°:
- μΉμΈμ¨ 50% λ―Έλ§
- ν‰κ·  μ μ 60μ  λ―Έλ§
- μ—°μ† μ‹¤ν¨ 3ν

```javascript
// API: POST /api/prompts/:key/auto-improve
{
  "dryRun": false  // trueλ©΄ μ μ©ν•μ§€ μ•κ³  μ μ•λ§
}
```

### 5.5 λ²„μ „ κ΄€λ¦¬

#### λ²„μ „ νμ¤ν† λ¦¬ μ΅°ν
```javascript
// API: GET /api/prompts/:key/versions
{
  "current": {
    "prompt_text": "ν„μ¬ λ²„μ „ ν…μ¤νΈ",
    "created_at": "2026-01-04T15:30:00Z"
  },
  "history": [
    {
      "version": 3,
      "prompt_text": "μ΄μ „ λ²„μ „ ν…μ¤νΈ",
      "change_reason": "ν”Όλ“λ°± #5 μ μ©",
      "created_at": "2026-01-03T10:00:00Z"
    },
    ...
  ]
}
```

#### λ²„μ „ λ³µμ›
```javascript
// API: POST /api/prompts/:key/versions/:version/restore
// μ) λ²„μ „ 2λ΅ λ³µμ›: POST /api/prompts/29/versions/2/restore
```

---

## 6. λ¬Έν•­ μƒμ„± λ° κ°μ„ 

### 6.1 λ‹¨μΌ λ¬Έν•­ μƒμ„±

#### μ›Ή UI μ‚¬μ©
1. `/generate` νμ΄μ§€ μ ‘μ†
2. λ¬Έν•­ μ ν• μ„ νƒ (μ: 29λ² μ–΄λ²•)
3. μµμ… μ„¤μ •
4. "μƒμ„±" λ²„νΌ ν΄λ¦­

#### API μ§μ ‘ νΈμ¶
```javascript
// 1. μ”μ²­ μƒμ„±
POST /api/items/requests
{
  "item_no": 29,
  "level": "μ¤‘",
  "topic": "ν™κ²½",
  "prompt_id": 221  // μ„ νƒμ‚¬ν•­
}
// μ‘λ‹µ: { "requestId": "abc-123-..." }

// 2. λ¬Έν•­ μƒμ„± μ‹¤ν–‰
POST /api/items/generate/abc-123-...
// μ‘λ‹µ: μƒμ„± κ²°κ³Ό + λ©”νΈλ¦­μ¤
```

### 6.2 μ„ΈνΈ λ¬Έν•­ μƒμ„±

RC41-45 κ°™μ€ μ¥λ¬Έ μ„ΈνΈ λ¬Έν•­:

```javascript
// 1. μ„ΈνΈ μƒμ„±
POST /api/sets
{
  "set_id": "SET_2026_01",
  "items": [
    { "item_no": 41 },
    { "item_no": 42 },
    { "item_no": 43 },
    { "item_no": 44 },
    { "item_no": 45 }
  ],
  "passage_source": "generate"  // μ§€λ¬Έ μλ™ μƒμ„±
}

// 2. μ„ΈνΈ μƒμ„± μ‹¤ν–‰
POST /api/sets/SET_2026_01/generate
```

### 6.3 λ¬Έν•­ μ¬μƒμ„±

μ‹¤ν¨ν• λ¬Έν•­ μ¬μƒμ„±:
```javascript
POST /api/items/generate/:requestId
```

### 6.4 μΌκ΄„ μ²λ¦¬

λ€κΈ° μ¤‘μΈ λ¨λ“  μ”μ²­ μ²λ¦¬:
```javascript
POST /api/items/generate-pending
// μ‘λ‹µ: { "ok": 10, "fail": 2, "total": 12 }
```

### 6.5 μƒμ„± κ²°κ³Ό ν™•μΈ

```javascript
GET /api/items/requests/:id
{
  "request": { ... },           // μ”μ²­ μ •λ³΄
  "results": [ ... ],           // μƒμ„± κ²°κ³Ό (JSON)
  "output": {                   // μ •κ·ν™”λ μ¶λ ¥
    "question": "λ°λ¬Έ",
    "option_1": "μ„ νƒμ§€1",
    ...
    "answer": "3",
    "explanation": "ν•΄μ„¤"
  },
  "metrics": {                  // ν’μ§ λ©”νΈλ¦­μ¤
    "layer1_score": 95,
    "layer2_score": 82,
    "layer3_score": 88,
    "final_score": 88.3,
    "grade": "B"
  },
  "promptInfo": {               // μ‚¬μ©λ ν”„λ΅¬ν”„νΈ μ •λ³΄
    "prompt_key": "29",
    "total_score": 92
  }
}
```

---

## 7. Metrics ν™μ©λ²•

### 7.1 ν”„λ΅¬ν”„νΈ λ©”νΈλ¦­μ¤

#### λ©”νΈλ¦­μ¤ ν•­λ©
| ν•­λ© | μ„¤λ… | κ³„μ‚° λ°©λ²• |
|------|------|----------|
| rule_score | κ·μΉ™ κΈ°λ° μ μ | ν•„μ μ”μ† ν¬ν•¨ μ—¬λ¶€ κ²€μ‚¬ |
| ai_score | AI ν‰κ°€ μ μ | LLM κΈ°λ° ν’μ§ ν‰κ°€ |
| total_score | ν†µν•© μ μ | (rule_score + ai_score) / 2 |
| grade | λ“±κΈ‰ | A(90+), B(80+), C(70+), D(60+), F |
| items_generated | μƒμ„± λ¬Έν•­ μ | ν•΄λ‹Ή ν”„λ΅¬ν”„νΈλ΅ μƒμ„±λ λ¬Έν•­ |
| approve_rate | μΉμΈμ¨ | OK λ¬Έν•­ / μ „μ²΄ λ¬Έν•­ |
| avg_item_score | ν‰κ·  λ¬Έν•­ μ μ | μƒμ„± λ¬Έν•­λ“¤μ ν‰κ·  ν’μ§ |

#### μ΅°ν λ°©λ²•
```javascript
// λ‹¨μΌ ν”„λ΅¬ν”„νΈ λ©”νΈλ¦­μ¤
GET /api/prompts/:key/metrics

// μ „μ²΄ λ©”νΈλ¦­μ¤ μ”μ•½
GET /api/prompts/metrics/summary
{
  "total": 50,
  "byGrade": { "A": 10, "B": 25, "C": 10, "D": 3, "F": 2 },
  "avgScore": 78.5,
  "needsImprovement": 5
}
```

#### λ©”νΈλ¦­μ¤ μ¬κ³„μ‚°
```javascript
// λ‹¨μΌ ν”„λ΅¬ν”„νΈ
POST /api/prompts/:key/metrics/calculate
{ "includeAI": true }  // AI ν‰κ°€ ν¬ν•¨ μ—¬λ¶€

// μ „μ²΄ ν”„λ΅¬ν”„νΈ
POST /api/prompts/metrics/recalculate-all
{ "includeAI": false }  // λ€λ‰ μ²λ¦¬μ‹ AI μ μ™Έ κ¶μ¥
```

### 7.2 λ¬Έν•­ λ©”νΈλ¦­μ¤ (3κ²Ή κ²€μ¦)

#### Layer 1: κµ¬μ΅° κ²€μ¦
```javascript
{
  "layer1_score": 95,
  "layer1_pass": true,
  "layer1_log": "λ¨λ“  ν•„μ ν•„λ“ μ΅΄μ¬, μ„ νƒμ§€ 5κ° ν™•μΈ"
}
```
κ²€μ¦ ν•­λ©:
- ν•„μ ν•„λ“ μ΅΄μ¬ μ—¬λ¶€ (passage, question, options, answer)
- μ„ νƒμ§€ κ°μ (5κ°)
- μ •λ‹µ λ²”μ„ (1-5)
- λ°μ΄ν„° νƒ€μ… μ •ν™•μ„±

#### Layer 2: λ‚΄μ© ν’μ§
```javascript
{
  "layer2_score": 82,
  "answer_in_options": 1,      // μ •λ‹µμ΄ μ„ νƒμ§€μ— ν¬ν•¨
  "distractor_uniqueness": 1,  // μ¤λ‹µ κ³ μ μ„±
  "layer2_rule_score": 80,
  "layer2_ai_score": 84,       // AI ν‰κ°€ (μ„ νƒ)
  "layer2_log": "μ •λ‹µ μ ν¨, μ¤λ‹µ λ³€λ³„λ ¥ μ–‘νΈ"
}
```
κ²€μ¦ ν•­λ©:
- μ •λ‹µμ΄ μ„ νƒμ§€μ— μ΅΄μ¬ν•λ”μ§€
- μ¤λ‹µλ“¤μ΄ μ„λ΅ λ‹¤λ¥Έμ§€
- μ¤λ‹µ λ§¤λ ¥λ„ (AI ν‰κ°€ μ‹)

#### Layer 3: μλ¥ μ ν•©μ„±
```javascript
{
  "layer3_score": 88,
  "word_count": 178,
  "sentence_count": 12,
  "avg_sentence_length": 14.8,
  "passage_length_score": 90,
  "format_score": 85,
  "layer3_log": "λ‹¨μ–΄ μ μ μ •, λ¬Έμ¥ κµ¬μ΅° μ–‘νΈ"
}
```
κ²€μ¦ ν•­λ©:
- μ§€λ¬Έ λ‹¨μ–΄ μ (μ ν•λ³„ κΈ°μ¤€)
- ν‰κ·  λ¬Έμ¥ κΈΈμ΄
- μλ¥ ν•μ‹ μ¤€μ

#### μµμΆ… μ μ λ° λ“±κΈ‰
```javascript
{
  "final_score": 88.3,  // (L1 + L2 + L3) / 3
  "grade": "B",
  "recommendation": "APPROVE"  // APPROVE, REVIEW, REJECT
}
```

### 7.3 λ©”νΈλ¦­μ¤ ν™μ© μ‹λ‚λ¦¬μ¤

#### μ‹λ‚λ¦¬μ¤ 1: μ €ν’μ§ ν”„λ΅¬ν”„νΈ μ°ΎκΈ°
```javascript
// κ°μ„  ν•„μ” ν”„λ΅¬ν”„νΈ μ¤μΊ”
GET /api/prompts/auto-improve/scan
{
  "scanned": 50,
  "needsImprovement": 5,
  "prompts": [
    {
      "promptKey": "31",
      "approveRate": 45,
      "avgScore": 58,
      "severity": "high",
      "reasons": ["low_approve_rate", "low_avg_score"]
    }
  ]
}
```

#### μ‹λ‚λ¦¬μ¤ 2: λ²„μ „λ³„ μ„±λ¥ λΉ„κµ
```javascript
GET /api/prompts/:key/version-performance
{
  "versions": [
    { "version": 3, "approveRate": 85, "avgScore": 82 },
    { "version": 2, "approveRate": 72, "avgScore": 75 },
    { "version": 1, "approveRate": 60, "avgScore": 65 }
  ],
  "trend": "improving"  // κ°μ„  μ¶”μ„Έ
}
```

#### μ‹λ‚λ¦¬μ¤ 3: λ¬Έν•­ ν’μ§ λ¶„μ„
```javascript
// νΉμ • μ”μ²­μ μƒμ„Έ λ©”νΈλ¦­μ¤
GET /api/items/requests/:id
// metrics ν•„λ“μ—μ„ κ° Layer μ μ ν™•μΈ

// λ“±κΈ‰λ³„ λ¬Έν•­ λ¶„ν¬ ν™•μΈ
// Dashboardμ—μ„ ν†µκ³„ ν™•μΈ
```

---

## 8. νμ¤ν† λ¦¬ λ° λ²„μ „ κ΄€λ¦¬

### 8.1 ν”„λ΅¬ν”„νΈ λ²„μ „ νμ¤ν† λ¦¬

#### μλ™ λ²„μ „ μƒμ„± μ‹μ 
- ν”„λ΅¬ν”„νΈ ν…μ¤νΈ μμ • μ‹
- AI κ°μ„  μ μ© μ‹
- ν”Όλ“λ°± κΈ°λ° κ°μ„  μ‹
- λ²„μ „ λ³µμ› μ‹ (λ°±μ—… μƒμ„±)

#### λ²„μ „ μ •λ³΄ μ΅°ν
```javascript
GET /api/prompts/:key/versions
{
  "current": {
    "version": "current",
    "prompt_text": "ν„μ¬ ν”„λ΅¬ν”„νΈ ν…μ¤νΈ...",
    "change_reason": "ν„μ¬ λ²„μ „",
    "created_at": "2026-01-04T15:30:00Z"
  },
  "history": [
    {
      "id": 45,
      "version": 3,
      "prompt_text": "μ΄μ „ λ²„μ „ ν…μ¤νΈ...",
      "change_reason": "μλ™ κ°μ„ : low_approve_rate",
      "created_at": "2026-01-03T10:00:00Z"
    },
    {
      "id": 32,
      "version": 2,
      "prompt_text": "λ” μ΄μ „ λ²„μ „...",
      "change_reason": "μλ™ μμ •",
      "created_at": "2026-01-02T14:00:00Z"
    }
  ],
  "total_versions": 4
}
```

#### λ²„μ „ λΉ„κµ (UI)
ν”„λ΅¬ν”„νΈ μƒμ„Έ ν™”λ©΄μ—μ„:
1. "λ²„μ „ νμ¤ν† λ¦¬" νƒ­ ν΄λ¦­
2. λ²„μ „ μ„ νƒν•μ—¬ ν…μ¤νΈ ν™•μΈ
3. ν•„μ”μ‹ "λ³µμ›" λ²„νΌμΌλ΅ λ΅¤λ°±

### 8.2 λ¬Έν•­ μƒμ„± νμ¤ν† λ¦¬

#### μ‹λ„λ³„ νμ¤ν† λ¦¬ μ΅°ν
κ° λ¬Έν•­ μƒμ„± μ”μ²­μ— λ€ν•΄ λ¨λ“  μ‹λ„ κΈ°λ΅ λ³΄μ΅΄:

```javascript
// item_generation_history ν…μ΄λΈ”
{
  "request_id": "abc-123",
  "attempt_no": 1,           // μ‹λ„ λ²νΈ
  "raw_json": "LLM μ›λ³Έ μ‘λ‹µ",
  "normalized_json": "μ •κ·ν™”λ JSON",
  "validation_result": "FAIL",
  "validation_log": "Layer1: options κ°μ λ¶€μ΅±",
  "error_message": "μ„ νƒμ§€κ°€ 4κ°λ§ μ΅΄μ¬",
  "created_at": "2026-01-04T15:30:00Z"
},
{
  "request_id": "abc-123",
  "attempt_no": 2,           // μ¬μ‹λ„
  "validation_result": "PASS",
  "validation_log": "OK",
  "created_at": "2026-01-04T15:30:15Z"
}
```

#### μ΅°ν λ°©λ²•
λ¬Έν•­ μƒμ„Έ ν™”λ©΄μ—μ„ "μƒμ„± νμ¤ν† λ¦¬" μ„Ήμ… ν™•μΈ
- κ° μ‹λ„μ μ„±κ³µ/μ‹¤ν¨ μ—¬λ¶€
- μ‹¤ν¨ μ›μΈ
- LLM μ›λ³Έ μ‘λ‹µ (λ””λ²„κΉ…μ©)

### 8.3 ν”„λ΅¬ν”„νΈ-λ¬Έν•­ λ²„μ „ μ—°κ²°

λ¬Έν•­ μƒμ„± μ‹ μ‚¬μ©λ ν”„λ΅¬ν”„νΈ λ²„μ „ μ¶”μ :

```javascript
// item_requests ν…μ΄λΈ”μ— μ €μ¥
{
  "request_id": "abc-123",
  "prompt_id": 221,
  "prompt_version": 3,              // μƒμ„± μ‹μ μ λ²„μ „
  "prompt_text_snapshot": "μƒμ„± μ‹ ν”„λ΅¬ν”„νΈ ν…μ¤νΈ..."
}
```

ν™μ©:
- νΉμ • λ²„μ „ ν”„λ΅¬ν”„νΈμ μ„±λ¥ λ¶„μ„
- λ²„μ „ μ—…κ·Έλ μ΄λ“ μ „ν›„ λΉ„κµ
- λ¬Έμ  λ°μƒ μ‹ μ›μΈ μ¶”μ 

---

## 9. κ³ κΈ‰ κΈ°λ¥

### 9.1 μλ™ μν™ κ°μ„  (Auto-Improve)

#### νΈλ¦¬κ±° μ΅°κ±΄
| μ΅°κ±΄ | μ„κ³„κ°’ | μ‹¬κ°λ„ |
|------|--------|--------|
| μµμ† μƒμ„± λ¬Έν•­ | 3κ° μ΄μƒ | - |
| μΉμΈμ¨ μ €ν• | 50% λ―Έλ§ | medium |
| ν‰κ·  μ μ μ €ν• | 60μ  λ―Έλ§ | medium |
| μ—°μ† μ‹¤ν¨ | 3ν μ΄μƒ | critical |

#### μ‚¬μ© λ°©λ²•

**1. μ „μ²΄ μ¤μΊ”**
```javascript
GET /api/prompts/auto-improve/scan
// κ°μ„  ν•„μ”ν• ν”„λ΅¬ν”„νΈ λ©λ΅ λ°ν™
```

**2. κ°λ³„ λ¶„μ„**
```javascript
GET /api/prompts/:key/auto-improve/analyze
{
  "promptId": 221,
  "needsImprovement": true,
  "reasons": ["low_approve_rate", "consecutive_failures"],
  "severity": "high",
  "suggestedActions": [
    "μΉμΈμ¨ ν–¥μƒμ„ μ„ν• ν”„λ΅¬ν”„νΈ κµ¬μ²΄ν™” ν•„μ”",
    "μ—°μ† μ‹¤ν¨λ΅ μΈν• κΈ΄κΈ‰ ν”„λ΅¬ν”„νΈ μ κ²€ ν•„μ”"
  ]
}
```

**3. μλ™ κ°μ„  μ‹¤ν–‰**
```javascript
// Dry Run (λ―Έλ¦¬λ³΄κΈ°)
POST /api/prompts/:key/auto-improve
{ "dryRun": true }

// μ‹¤μ  μ μ©
POST /api/prompts/:key/auto-improve
{ "dryRun": false }
```

### 9.2 A/B ν…μ¤ν…

λ‘ λ²„μ „μ ν”„λ΅¬ν”„νΈ μ„±λ¥μ„ λΉ„κµ:

#### ν…μ¤νΈ μƒμ„±
```javascript
POST /api/prompts/:key/ab-test
{
  "test_name": "29λ² ν”„λ΅¬ν”„νΈ κ°μ„  ν…μ¤νΈ",
  "version_a": 2,    // μ΄μ „ λ²„μ „
  "version_b": 0     // 0 = ν„μ¬ λ²„μ „
}
```

#### ν…μ¤νΈ λ©λ΅ μ΅°ν
```javascript
GET /api/prompts/ab-tests
GET /api/prompts/ab-tests?status=active  // μ§„ν–‰ μ¤‘μΈ ν…μ¤νΈλ§
```

#### ν…μ¤νΈ κ²°κ³Ό μ΅°ν
```javascript
GET /api/prompts/ab-tests/:testId
{
  "test": {
    "id": 1,
    "testName": "29λ² ν”„λ΅¬ν”„νΈ κ°μ„  ν…μ¤νΈ",
    "status": "active"
  },
  "versionA": {
    "version": 2,
    "stats": {
      "totalItems": 15,
      "approveRate": 73.3,
      "avgScore": 75.2
    }
  },
  "versionB": {
    "version": 0,
    "stats": {
      "totalItems": 18,
      "approveRate": 88.9,
      "avgScore": 84.5
    }
  },
  "analysis": {
    "sufficientData": true,
    "comparison": {
      "approveRate": { "winner": "B", "difference": "+15.6%" },
      "avgScore": { "winner": "B", "difference": "+9.3" }
    },
    "recommendation": "λ²„μ „ Bκ°€ λ” λ‚μ€ μ„±λ¥μ„ λ³΄μ…λ‹λ‹¤.",
    "suggestedWinner": "B",
    "confidence": "high"
  }
}
```

#### ν…μ¤νΈ μΆ…λ£
```javascript
POST /api/prompts/ab-tests/:testId/complete
{
  "winner": "B",         // "A", "B", "tie"
  "apply_winner": true   // μΉμ λ²„μ „μ„ ν„μ¬λ΅ μ μ©
}
```

### 9.3 ν”Όλ“λ°± μμ§‘ μ‹μ¤ν…

#### ν”Όλ“λ°± μ¶”κ°€
```javascript
POST /api/prompts/:key/feedback
{
  "feedback_type": "improvement",  // improvement, bug, suggestion
  "feedback_text": "μ¤λ‹µ λ§¤λ ¥λ„κ°€ λ‚®μµλ‹λ‹¤. λ” κ·Έλ΄λ“―ν• μ¤λ‹µ μƒμ„± μ§€μΉ¨μ΄ ν•„μ”ν•©λ‹λ‹¤.",
  "request_id": "abc-123",         // κ΄€λ ¨ λ¬Έν•­ (μ„ νƒ)
  "item_score": 65                 // ν•΄λ‹Ή λ¬Έν•­ μ μ (μ„ νƒ)
}
```

#### ν”Όλ“λ°± λ©λ΅ μ΅°ν
```javascript
GET /api/prompts/:key/feedback
{
  "feedbacks": [...],
  "stats": {
    "total": 10,
    "applied_count": 3,
    "auto_improve_count": 2,
    "user_count": 8
  }
}
```

#### ν”Όλ“λ°± μ μ©
```javascript
POST /api/prompts/:key/feedback/:feedbackId/apply
// AIκ°€ ν”Όλ“λ°±μ„ λ¶„μ„ν•μ—¬ ν”„λ΅¬ν”„νΈ μλ™ κ°μ„ 
```

### 9.4 ν”„λ΅¬ν”„νΈ μƒνƒ κ΄€λ¦¬

#### μƒνƒ νλ¦„
```
draft β†’ testing β†’ approved β†’ archived
  β†‘        β†“         β†“
  β””β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### μƒνƒλ³„ μλ―Έ
| μƒνƒ | μ„¤λ… |
|------|------|
| draft | μ΄μ• (νΈμ§‘ μ¤‘) |
| testing | ν…μ¤νΈ μ¤‘ (A/B ν…μ¤νΈ λ“±) |
| approved | μΉμΈλ¨ (μ΄μ μ‚¬μ©) |
| archived | λ³΄κ΄€λ¨ (λ―Έμ‚¬μ©) |

#### μƒνƒ λ³€κ²½
```javascript
PUT /api/prompts/:key/status
{
  "status": "approved",
  "reason": "A/B ν…μ¤νΈ ν†µκ³Ό"
}
```

---

## 10. API λ νΌλ°μ¤

### 10.1 ν”„λ΅¬ν”„νΈ API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | /api/prompts | μ „μ²΄ ν”„λ΅¬ν”„νΈ λ©λ΅ |
| GET | /api/prompts/:key | νΉμ • ν”„λ΅¬ν”„νΈ μ΅°ν |
| POST | /api/prompts | μƒ ν”„λ΅¬ν”„νΈ μƒμ„± |
| PUT | /api/prompts/:key | ν”„λ΅¬ν”„νΈ μμ • |
| DELETE | /api/prompts/:key | ν”„λ΅¬ν”„νΈ μ‚­μ  |
| GET | /api/prompts/:key/versions | λ²„μ „ νμ¤ν† λ¦¬ |
| POST | /api/prompts/:key/versions/:v/restore | λ²„μ „ λ³µμ› |
| GET | /api/prompts/:key/metrics | λ©”νΈλ¦­μ¤ μ΅°ν |
| POST | /api/prompts/:key/metrics/calculate | λ©”νΈλ¦­μ¤ μ¬κ³„μ‚° |
| POST | /api/prompts/:key/evaluate | AI ν‰κ°€ |
| POST | /api/prompts/:key/quick-validate | λΉ λ¥Έ κ²€μ¦ |
| POST | /api/prompts/:key/improve | ν”Όλ“λ°± κΈ°λ° κ°μ„  |
| GET | /api/prompts/auto-improve/scan | κ°μ„  ν•„μ” μ¤μΊ” |
| GET | /api/prompts/:key/auto-improve/analyze | μ„±λ¥ λ¶„μ„ |
| POST | /api/prompts/:key/auto-improve | μλ™ κ°μ„  μ‹¤ν–‰ |
| GET | /api/prompts/:key/version-performance | λ²„μ „λ³„ μ„±λ¥ |
| GET | /api/prompts/:key/feedback | ν”Όλ“λ°± λ©λ΅ |
| POST | /api/prompts/:key/feedback | ν”Όλ“λ°± μ¶”κ°€ |
| POST | /api/prompts/:key/feedback/:id/apply | ν”Όλ“λ°± μ μ© |
| GET | /api/prompts/ab-tests | A/B ν…μ¤νΈ λ©λ΅ |
| GET | /api/prompts/ab-tests/:id | ν…μ¤νΈ κ²°κ³Ό |
| POST | /api/prompts/:key/ab-test | ν…μ¤νΈ μƒμ„± |
| POST | /api/prompts/ab-tests/:id/complete | ν…μ¤νΈ μΆ…λ£ |
| DELETE | /api/prompts/ab-tests/:id | ν…μ¤νΈ μ‚­μ  |

### 10.2 λ¬Έν•­ API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | /api/items/requests | μ”μ²­ λ©λ΅ |
| GET | /api/items/requests/:id | μ”μ²­ μƒμ„Έ |
| POST | /api/items/requests | μƒ μ”μ²­ μƒμ„± |
| DELETE | /api/items/requests/:id | μ”μ²­ μ‚­μ  |
| POST | /api/items/generate/:id | λ¬Έν•­ μƒμ„± |
| POST | /api/items/generate-pending | λ€κΈ° λ¬Έν•­ μΌκ΄„ μƒμ„± |
| POST | /api/items/preview-prompt | ν”„λ΅¬ν”„νΈ λ―Έλ¦¬λ³΄κΈ° |
| GET | /api/items/outputs | μƒμ„±λ λ¬Έν•­ λ©λ΅ |

### 10.3 μ„ΈνΈ API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | /api/sets | μ„ΈνΈ λ©λ΅ |
| POST | /api/sets | μƒ μ„ΈνΈ μƒμ„± |
| POST | /api/sets/:setId/generate | μ„ΈνΈ λ¬Έν•­ μƒμ„± |

### 10.4 μ„¤μ • API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | /api/config | μ „μ²΄ μ„¤μ • μ΅°ν |
| GET | /api/config/:key | νΉμ • μ„¤μ • μ΅°ν |
| PUT | /api/config/:key | μ„¤μ • λ³€κ²½ |

### 10.5 λ΅κ·Έ API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | /api/logs | λ΅κ·Έ λ©λ΅ |
| GET | /api/logs/errors | μ—λ¬ λ΅κ·Έ |
| GET | /api/logs/stats | λ΅κ·Έ ν†µκ³„ |
| DELETE | /api/logs/clear | μ¤λλ λ΅κ·Έ μ‚­μ  |

---

## λ¶€λ΅: λ¬Έμ  ν•΄κ²°

### μμ£Ό λ°μƒν•λ” λ¬Έμ 

#### 1. λ¬Έν•­ μƒμ„± μ‹¤ν¨ (FAIL)
**μ¦μƒ**: λ¬Έν•­ μƒμ„± ν›„ μƒνƒκ°€ FAIL

**ν™•μΈ μ‚¬ν•­**:
1. λ΅κ·Έ νμ΄μ§€μ—μ„ μ—λ¬ ν™•μΈ
2. λ¬Έν•­ μƒμ„Έμ—μ„ μ‹λ„λ³„ νμ¤ν† λ¦¬ ν™•μΈ
3. LLM μ‘λ‹µμ΄ JSON ν•μ‹μΈμ§€ ν™•μΈ

**ν•΄κ²° λ°©λ²•**:
- ν”„λ΅¬ν”„νΈμ— JSON ν•μ‹ μ§€μ‹ κ°•ν™”
- MAX_RETRY κ°’ μ¦κ°€
- λ‹¤λ¥Έ LLM λ¨λΈ μ‹λ„

#### 2. λ‚®μ€ μΉμΈμ¨
**μ¦μƒ**: ν”„λ΅¬ν”„νΈ μΉμΈμ¨μ΄ 50% λ―Έλ§

**ν™•μΈ μ‚¬ν•­**:
1. `/api/prompts/:key/auto-improve/analyze`λ΅ λ¶„μ„
2. μ‹¤ν¨ λ¬Έν•­λ“¤μ κ³µν†µ μ›μΈ ν™•μΈ

**ν•΄κ²° λ°©λ²•**:
- μλ™ κ°μ„  μ‹¤ν–‰: `POST /api/prompts/:key/auto-improve`
- μλ™μΌλ΅ ν”„λ΅¬ν”„νΈ κ°μ„ 
- A/B ν…μ¤νΈλ΅ κ°μ„  ν¨κ³Ό κ²€μ¦

#### 3. API νƒ€μ„μ•„μ›ƒ
**μ¦μƒ**: λ¬Έν•­ μƒμ„± μ‹ νƒ€μ„μ•„μ›ƒ μ—λ¬

**ν•΄κ²° λ°©λ²•**:
- μ„¤μ •μ—μ„ TIMEOUT_MS κ°’ μ¦κ°€
- LLM λ¨λΈ λ³€κ²½ (λ” λΉ λ¥Έ λ¨λΈ)
- λ„¤νΈμ›ν¬ μƒνƒ ν™•μΈ

### λ΅κ·Έ λ¶„μ„ λ°©λ²•

1. `/logs` νμ΄μ§€ μ ‘μ†
2. ERROR λ λ²¨ ν•„ν„°λ§
3. μ”μ²­ IDλ΅ κ΄€λ ¨ λ΅κ·Έ μ¶”μ 
4. μ¤νƒ νΈλ μ΄μ¤ ν™•μΈ

---

*λ§μ§€λ§‰ μ—…λ°μ΄νΈ: 2026-01-04*
