/**
 * 모든 문항별 프롬프트에 오답 설계 지침 추가 스크립트
 * 실행: node server/scripts/addDistractorGuidelines.js
 */

const { initDatabase, getDb, saveDatabase, closeDatabase } = require('../db/database');

// 문항 유형별 오답 설계 지침
const DISTRACTOR_GUIDELINES = {
  // ===== RC (독해) 문항 =====

  // RC18: 글의 목적
  'RC18': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력 목표**: 상위권 학생이 마지막까지 고민하도록 설계

### 개별 선택지 역할
① **정답**: 글의 주된 의사소통 목적을 정확히 반영
② **오답 (부분 일치)**: 글에 언급된 부차적 내용을 목적으로 오인하게 함
③ **오답 (과잉 일반화)**: 글의 범위를 넘어서는 포괄적 목적 제시
④ **오답 (인접 혼동)**: 유사한 상황에서 있을 법한 다른 목적
⑤ **오답 (세부 함정)**: 글의 특정 표현에만 집중하게 유도

### 오답 매력도 확보 전략
- 모든 오답은 문맥상 그럴듯해 보여야 함
- 정답은 D-E 단계까지 읽어야 확정 가능하도록 설계
- 하위권은 A-C 단계에서 성급한 판단으로 오답 선택 유도
`,

  // RC19: 심경 변화
  'RC19': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **형식**: "A → B" 형태의 심경 변화 쌍

### 개별 선택지 역할
① **정답**: 글의 전후 심경 변화를 정확히 포착
② **오답 (순서 역전)**: 변화 방향을 반대로 제시 (B → A)
③ **오답 (부분 감정)**: 전반부 또는 후반부 감정만 정확
④ **오답 (유사 감정)**: 비슷하지만 다른 감정 쌍 제시
⑤ **오답 (무관 감정)**: 글에서 추론 불가능한 감정 제시

### 오답 매력도 확보 전략
- 감정 어휘의 미묘한 차이 활용 (anxious vs nervous)
- 전환점 이전 감정에 집중한 오답 배치
`,

  // RC20: 주장
  'RC20': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 주장의 핵심과 부수적 내용 구분 능력 측정

### 개별 선택지 역할
① **정답**: 필자의 핵심 주장을 정확히 반영
② **오답 (근거 혼동)**: 주장을 뒷받침하는 근거를 주장으로 오인
③ **오답 (범위 축소)**: 주장의 일부분만 포착
④ **오답 (과잉 확대)**: 글의 범위를 넘어선 주장
⑤ **오답 (반대 주장)**: 필자 입장과 상반되는 내용

### 오답 매력도 확보 전략
- 근거와 주장의 경계를 모호하게 하는 오답
- 글 초반 언급 내용을 주장으로 착각하게 유도
`,

  // RC21: 함축 의미
  'RC21': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 표면적 의미와 함축적 의미 구분 능력 측정

### 개별 선택지 역할
① **정답**: 밑줄 친 표현의 문맥적 함축 의미
② **오답 (사전적 의미)**: 표현의 글자 그대로의 의미
③ **오답 (부분 의미)**: 함축 의미의 일부만 포착
④ **오답 (과도 해석)**: 문맥을 벗어난 과장된 해석
⑤ **오답 (연관 오해)**: 관련 있어 보이지만 다른 의미

### 오답 매력도 확보 전략
- 관용적 표현이나 비유적 표현 활용
- 정답은 전체 맥락을 고려해야 도출 가능
`,

  // RC22: 요지
  'RC22': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 세부 내용과 핵심 요지 구분 능력

### 개별 선택지 역할
① **정답**: 글의 핵심 메시지를 정확히 요약
② **오답 (예시 혼동)**: 예시나 사례를 요지로 착각
③ **오답 (부분 요약)**: 글의 일부만 반영한 불완전한 요지
④ **오답 (확대 해석)**: 글에서 직접 언급되지 않은 내용 포함
⑤ **오답 (반대 요지)**: 글의 메시지와 상반되는 내용

### 오답 매력도 확보 전략
- 구체적 예시를 요지로 오인하게 유도
- 도입부 내용만으로 판단 시 오답 선택 유도
`,

  // RC23: 주제
  'RC23': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 포괄적 주제와 세부 소재 구분 능력

### 개별 선택지 역할
① **정답**: 글 전체를 관통하는 핵심 주제
② **오답 (소재 혼동)**: 글에서 다루는 소재를 주제로 착각
③ **오답 (범위 축소)**: 특정 단락의 내용만 반영
④ **오답 (범위 확대)**: 글의 범위를 벗어난 광범위한 주제
⑤ **오답 (관련 주제)**: 관련 있지만 글의 초점과 다른 주제

### 오답 매력도 확보 전략
- 제목과 혼동될 수 있는 오답 배치
- 글의 도입부에서 언급된 배경을 주제로 오인하게 유도
`,

  // RC24: 제목
  'RC24': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 적절한 제목 선정 능력

### 개별 선택지 역할
① **정답**: 글의 핵심 내용과 톤을 반영하는 제목
② **오답 (부분 반영)**: 글의 일부 내용만 반영한 제목
③ **오답 (과잉 포괄)**: 너무 광범위하고 일반적인 제목
④ **오답 (세부 초점)**: 특정 예시나 세부 사항에만 집중
⑤ **오답 (매력적 표현)**: 흥미롭지만 내용과 불일치

### 오답 매력도 확보 전략
- 눈길을 끄는 표현이지만 내용과 불일치하는 오답
- 글의 부차적 소재를 강조한 제목
`,

  // RC29: 어법
  'RC29': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 밑줄**: 정답(어법상 틀린 것) 1개 + 맞는 표현 4개
- **변별력**: 세밀한 문법 지식과 문맥 파악 능력

### 개별 밑줄 역할
① **정답 (오류)**: 문법적으로 틀린 표현 (수정 필요)
② **오답 (함정)**: 헷갈리기 쉽지만 문법적으로 맞는 표현
③ **오답 (함정)**: 다른 문법 규칙으로 혼동 유도
④ **오답 (평범)**: 명백히 맞는 표현 (쉬운 선지)
⑤ **오답 (평범)**: 명백히 맞는 표현 (쉬운 선지)

### 문법 오류 유형 (정답용)
- 주어-동사 수일치 오류
- 능동/수동 혼동
- 분사 (현재분사/과거분사) 선택 오류
- 관계대명사 격 오류
- to부정사/동명사 선택 오류

### 함정 선지 설계 (오답용)
- 정답처럼 보이지만 문맥상 맞는 표현
- 익숙하지 않은 구문이지만 정확한 표현
`,

  // RC30: 어휘
  'RC30': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 밑줄**: 부적절한 어휘(정답) 1개 + 적절한 어휘 4개
- **변별력**: 문맥에 맞는 어휘 선택 능력

### 개별 밑줄 역할
① **정답 (부적절)**: 문맥상 반대되거나 어울리지 않는 어휘
② **오답 (함정)**: 어색해 보이지만 문맥상 적절한 어휘
③ **오답 (함정)**: 의미가 비슷해 보이지만 정확한 어휘
④ **오답 (평범)**: 명백히 문맥에 맞는 어휘
⑤ **오답 (평범)**: 명백히 문맥에 맞는 어휘

### 오답 매력도 확보 전략
- 동의어/반의어 관계 활용
- 다의어의 문맥적 의미 파악 필요
- 논리적 흐름을 따라가야 부적절함 파악 가능
`,

  // RC31-33: 빈칸 추론
  'RC31': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 문맥적 추론 및 논리적 완성 능력

### 개별 선택지 역할
① **정답**: 빈칸에 들어가 글의 논리를 완성하는 표현
② **오답 (부분 일치)**: 글의 일부와 관련 있지만 전체 맥락에 부적합
③ **오답 (반대 논리)**: 글의 논지와 상반되는 내용
④ **오답 (관련 어휘)**: 같은 주제 영역이지만 문맥에 부적합
⑤ **오답 (매력적 표현)**: 그럴듯해 보이지만 논리적 연결 부족

### 오답 매력도 확보 전략
- 빈칸 전후 문장만으로는 정답 확정 불가
- 글 전체의 논리적 흐름 파악 필요
- 오답도 단독으로 보면 의미 있는 표현
`,

  'RC32': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 심화된 문맥적 추론 능력 (RC31보다 고난도)

### 개별 선택지 역할
① **정답**: 글의 핵심 논지를 완성하는 추상적 표현
② **오답 (표면적)**: 글의 표면적 내용만 반영
③ **오답 (과잉 추론)**: 글에서 직접 추론 불가능한 내용
④ **오답 (부분 적합)**: 일부 문장과는 어울리지만 전체와 부조화
⑤ **오답 (유사 개념)**: 비슷한 개념이지만 미묘하게 다른 의미

### 오답 매력도 확보 전략
- 추상적 표현으로 구성된 선택지
- 정답은 글의 주제문/결론부와 긴밀히 연결
`,

  'RC33': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 최고난도 빈칸 추론 (추상적/철학적 내용)

### 개별 선택지 역할
① **정답**: 글의 핵심 통찰을 담은 표현
② **오답 (단순화)**: 글의 복잡한 논지를 지나치게 단순화
③ **오답 (곡해)**: 글의 의미를 왜곡한 표현
④ **오답 (관련 개념)**: 관련 있지만 글의 초점과 다른 개념
⑤ **오답 (정반대)**: 글의 논지와 정면으로 배치되는 내용

### 오답 매력도 확보 전략
- 철학적/추상적 어휘 사용
- 모든 선택지가 학술적으로 의미 있어 보임
- 글 전체의 논증 구조 파악 필수
`,

  // RC34: 빈칸 (연결어)
  'RC34': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **형식**: (A), (B) 두 빈칸에 들어갈 연결어 조합

### 개별 선택지 역할
① **정답**: 문맥의 논리적 흐름에 맞는 연결어 쌍
② **오답 (부분 정답)**: (A)만 맞거나 (B)만 맞는 조합
③ **오답 (부분 정답)**: (A)만 맞거나 (B)만 맞는 조합
④ **오답 (역전)**: 논리 관계를 반대로 파악한 조합
⑤ **오답 (무관)**: 문맥과 무관한 연결어 조합

### 연결어 유형
- **순접**: therefore, thus, hence, consequently
- **역접**: however, nevertheless, nonetheless, yet
- **예시**: for example, for instance, in other words
- **추가**: moreover, furthermore, in addition
- **대조**: on the other hand, in contrast, conversely

### 오답 매력도 확보 전략
- 부분적으로만 맞는 조합 배치
- 연결어의 미묘한 뉘앙스 차이 활용
`,

  // RC35: 흐름 무관 문장
  'RC35': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 문장**: 무관 문장(정답) 1개 + 관련 문장 4개
- **변별력**: 글의 통일성 및 응집성 파악 능력

### 개별 문장 역할
① **정답 (무관 문장)**: 주제와 관련 있어 보이지만 논리적 흐름을 방해
② **오답**: 글의 주제 도입 또는 배경 설명
③ **오답**: 핵심 주장 또는 논거 제시
④ **오답**: 예시 또는 부연 설명
⑤ **오답**: 결론 또는 요약

### 무관 문장 설계 전략
- 같은 주제 영역의 어휘 사용 (표면적 관련성)
- 논리적 연결고리 부재 (실제 무관성)
- 삭제해도 글의 흐름이 자연스러워지는 문장

### 오답 매력도 확보 전략
- 모든 문장이 같은 주제 영역의 어휘 포함
- 무관 문장도 그 자체로는 의미 있는 정보 제공
`,

  // RC36-37: 순서 배열
  'RC36': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 순서 1개 + 오답 순서 4개
- **변별력**: 글의 논리적 전개 파악 능력

### 개별 선택지 역할
① **정답**: (A)-(B)-(C)의 논리적으로 올바른 배열
② **오답**: 첫 문단만 맞고 나머지 순서 오류
③ **오답**: 마지막 문단만 맞고 나머지 순서 오류
④ **오답**: 일부 순서만 맞는 배열
⑤ **오답**: 완전히 잘못된 배열 (명백한 오답)

### 순서 단서 활용
- 지시어 (this, these, such, the + 명사)
- 연결어 (however, therefore, moreover)
- 대명사의 선행사 관계
- 시간 순서 표현
- 논리적 인과관계

### 오답 매력도 확보 전략
- 표면적으로 연결 가능해 보이는 오답 순서
- 연결어만으로 판단 시 오류 발생 가능한 배열
`,

  'RC37': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 순서 1개 + 오답 순서 4개
- **변별력**: 복잡한 논리 구조 파악 능력 (RC36보다 고난도)

### 개별 선택지 역할
① **정답**: 완벽한 논리적 순서
② **오답**: (A)의 위치만 정확한 배열
③ **오답**: (C)의 위치만 정확한 배열
④ **오답**: 두 문단 순서가 뒤바뀐 배열
⑤ **오답**: 논리적 혼란을 주는 배열

### 오답 매력도 확보 전략
- 각 문단의 독립성이 높아 여러 순서가 가능해 보임
- 주어진 글과의 연결이 핵심 단서
`,

  // RC38-39: 문장 삽입
  'RC38': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 위치**: 정답 위치 1개 + 오답 위치 4개
- **변별력**: 문장의 논리적 위치 파악 능력

### 개별 위치 역할
① **정답**: 주어진 문장이 논리적으로 연결되는 유일한 위치
② **오답**: 표면적으로 연결 가능해 보이는 위치
③ **오답**: 지시어가 가리킬 대상이 있어 보이는 위치
④ **오답**: 주제 관련 어휘가 있는 위치
⑤ **오답**: 명백히 부적절한 위치 (쉬운 선지)

### 삽입 문장 단서
- 지시어 (This, Such, These)
- 연결어 (However, Therefore, For example)
- 정관사 + 명사 (the idea, the concept)
- 대명사와 선행사 관계

### 오답 매력도 확보 전략
- 삽입 문장의 키워드와 유사한 어휘가 있는 오답 위치
- 부분적으로 연결 가능해 보이는 위치
`,

  'RC39': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 위치**: 정답 위치 1개 + 오답 위치 4개
- **변별력**: 복잡한 텍스트에서 논리적 위치 파악 (RC38보다 고난도)

### 개별 위치 역할
① **정답**: 논리적 필연성이 있는 유일한 위치
② **오답**: 어휘적 연결만 있는 위치
③ **오답**: 주제적 연결만 있는 위치
④ **오답**: 시간적/공간적 연결이 있어 보이는 위치
⑤ **오답**: 명백한 오답 (기초 수준)

### 오답 매력도 확보 전략
- 더 복잡한 지시 관계 설정
- 삽입 문장 자체가 복문/중문으로 구성
`,

  // RC40: 요약문 완성
  'RC40': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 조합 1개 + 오답 조합 4개
- **형식**: (A), (B) 두 빈칸에 들어갈 어휘 조합

### 개별 선택지 역할
① **정답**: 요약문을 정확히 완성하는 어휘 쌍
② **오답 (부분 정답)**: (A)만 적절하거나 (B)만 적절
③ **오답 (부분 정답)**: (A)만 적절하거나 (B)만 적절
④ **오답 (반대 의미)**: 글의 논지와 반대되는 어휘 포함
⑤ **오답 (무관 어휘)**: 글에서 다루지 않은 개념

### 오답 매력도 확보 전략
- 글에 등장한 어휘를 활용한 오답
- 요약문 구조상 어색하지 않은 어휘 조합
- 정답과 유의어/반의어 관계인 오답 어휘
`,

  // ===== LC (듣기) 문항 =====

  'LC01': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 대화의 핵심 목적 파악 능력

### 개별 선택지 역할
① **정답**: 대화의 주된 목적
② **오답**: 대화 중 언급된 부차적 행위
③ **오답**: 대화 상황에서 예상 가능한 다른 목적
④ **오답**: 특정 발화에만 초점을 맞춘 목적
⑤ **오답**: 전혀 다른 상황의 목적

### 오답 매력도 확보 전략
- 대화 초반 내용만으로 판단 시 오답 선택 유도
- 대화에서 실제 언급된 어휘 활용
`,

  'LC02': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 화자의 의견/태도 파악 능력

### 개별 선택지 역할
① **정답**: 화자의 핵심 의견
② **오답**: 화자가 반박하는 의견
③ **오답**: 대화 상대방의 의견
④ **오답**: 화자가 고려는 하지만 채택하지 않은 의견
⑤ **오답**: 대화 주제와 관련 있지만 언급되지 않은 의견

### 오답 매력도 확보 전략
- 화자의 최종 입장과 중간 발언 구분 필요
- 반어적 표현이나 조건부 동의 구분 필요
`,

  'LC03': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 화자 간 관계 추론 능력

### 개별 선택지 역할
① **정답**: 대화 내용으로 추론 가능한 정확한 관계
② **오답**: 대화 장소/상황에서 예상 가능한 다른 관계
③ **오답**: 일부 발화와 일치하지만 전체와 불일치
④ **오답**: 유사한 상황의 다른 관계
⑤ **오답**: 명백히 부적절한 관계

### 오답 매력도 확보 전략
- 대화 초반 단서만으로 오인 가능한 관계
- 직업/역할 관련 어휘의 중의성 활용
`,

  // LC04-LC17: 일반적인 듣기 문항 지침
  'LC04': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 그림/도표 정보와 대화 내용 매칭 능력

### 개별 선택지 역할
① **정답**: 대화 내용과 완전히 일치하는 그림
② **오답**: 일부 특징만 일치하는 그림
③ **오답**: 언급된 특징과 반대되는 그림
④ **오답**: 언급되지 않은 특징이 있는 그림
⑤ **오답**: 대화 초반 언급과만 일치하는 그림

### 오답 매력도 확보 전략
- 복수의 시각적 특징을 순차적으로 언급
- 마지막 확정 정보가 핵심 단서
`,

  'LC05': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 화자가 할 일 정확히 파악

### 개별 선택지 역할
① **정답**: 화자가 실제로 하기로 한 행동
② **오답**: 화자가 고려했지만 거절한 행동
③ **오답**: 상대방이 하기로 한 행동
④ **오답**: 이미 완료된 행동
⑤ **오답**: 대화에서 언급만 된 행동

### 오답 매력도 확보 전략
- 대화 흐름 중 변경되는 계획 활용
- 조건부 약속과 확정 약속 구분 필요
`,

  // 공통 LC 템플릿 (LC06-LC15)
  'LC06': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개

### 개별 선택지 역할
① **정답**: 대화에서 명시적으로 확인 가능한 정보
② **오답**: 대화에서 언급되었지만 정답이 아닌 정보
③ **오답**: 추론 가능하지만 직접 언급되지 않은 정보
④ **오답**: 대화 주제와 관련 있지만 언급되지 않은 정보
⑤ **오답**: 명백히 대화 내용과 불일치하는 정보

### 오답 매력도 확보 전략
- 대화에서 실제 사용된 어휘를 오답에도 활용
- 숫자, 시간, 장소 등 구체적 정보의 혼동 유도
`,

  'LC07': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 숫자/금액 계산 및 파악 능력

### 개별 선택지 역할
① **정답**: 정확한 계산 결과
② **오답**: 할인/추가 요금 미반영
③ **오답**: 수량 오류
④ **오답**: 단위 가격만 제시
⑤ **오답**: 완전히 다른 계산 결과

### 오답 매력도 확보 전략
- 중간 계산 과정의 숫자를 오답으로 활용
- 조건부 할인/추가 요금의 적용 여부
`,

  'LC08': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답(언급되지 않은 것) 1개 + 오답(언급된 것) 4개

### 개별 선택지 역할
① **정답**: 대화에서 전혀 언급되지 않은 내용
② **오답**: 명시적으로 언급된 내용 1
③ **오답**: 명시적으로 언급된 내용 2
④ **오답**: 명시적으로 언급된 내용 3
⑤ **오답**: 명시적으로 언급된 내용 4

### 오답 매력도 확보 전략
- 정답(언급 안 된 것)이 대화 주제와 관련 있어 보이게 설계
- 대화 맥락상 언급될 법한 내용을 정답으로 설정
`,

  'LC09': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 대화/담화 내용 일치 여부 파악

### 개별 선택지 역할
① **정답**: 내용과 정확히 일치하는 선택지
② **오답**: 부분적으로만 일치 (세부 사항 오류)
③ **오답**: 정반대 내용
④ **오답**: 언급되지 않은 내용
⑤ **오답**: 관련 있어 보이지만 직접 언급되지 않은 내용

### 오답 매력도 확보 전략
- 숫자, 날짜, 장소 등 세부 정보 변형
- 담화에서 사용된 어휘를 활용한 오답
`,

  'LC10': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 도표 정보와 담화 내용 매칭 능력

### 개별 선택지 역할
① **정답**: 도표와 담화 내용 모두 일치
② **오답**: 도표와 일치하지만 담화와 불일치
③ **오답**: 담화와 일치하지만 도표와 불일치
④ **오답**: 도표의 다른 항목과 혼동
⑤ **오답**: 담화의 다른 부분과 혼동

### 오답 매력도 확보 전략
- 도표와 담화 중 하나만 집중하면 오답 선택 유도
- 유사한 수치/항목 간 혼동 유도
`,

  'LC11': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 상황에 적절한 응답 선택 능력

### 개별 선택지 역할
① **정답**: 대화 맥락에 가장 자연스러운 응답
② **오답**: 문법적으로 맞지만 맥락에 부적절
③ **오답**: 대화 주제와 관련 있지만 어색한 응답
④ **오답**: 이전 발화의 일부에만 반응하는 응답
⑤ **오답**: 명백히 부자연스러운 응답

### 오답 매력도 확보 전략
- 대화의 표면적 질문에만 답하는 오답
- 화용론적 적절성을 고려해야 정답 선택 가능
`,

  'LC12': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 긴 대화에서 적절한 응답 선택

### 개별 선택지 역할
① **정답**: 대화 전체 맥락을 고려한 적절한 응답
② **오답**: 대화 초반 내용에만 적절한 응답
③ **오답**: 대화 중간 내용에만 적절한 응답
④ **오답**: 표면적으로 관련 있지만 맥락상 부적절
⑤ **오답**: 대화 주제와 무관한 응답

### 오답 매력도 확보 전략
- 대화 전체 흐름 파악 필요
- 마지막 발화의 의도 정확히 파악 필요
`,

  'LC13': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 상황 설명 후 적절한 말 선택

### 개별 선택지 역할
① **정답**: 주어진 상황에 가장 적절한 발화
② **오답**: 상황의 일부에만 적절한 발화
③ **오답**: 비슷한 상황에서 쓸 수 있지만 이 상황에는 부적절
④ **오답**: 역할이 뒤바뀐 상황에 적절한 발화
⑤ **오답**: 상황과 무관한 발화

### 오답 매력도 확보 전략
- 상황의 핵심 요소 (화자의 입장, 목적, 상대방과의 관계) 파악 필요
- 공손성 수준, 격식 수준 고려 필요
`,

  'LC14': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 담화를 듣고 세부 정보 파악

### 개별 선택지 역할
① **정답**: 담화 내용과 정확히 일치
② **오답**: 유사하지만 세부 사항 오류
③ **오답**: 담화에서 언급된 다른 정보
④ **오답**: 추론 가능하지만 직접 언급되지 않은 정보
⑤ **오답**: 담화 주제와 관련 있지만 언급되지 않은 정보

### 오답 매력도 확보 전략
- 숫자, 날짜, 장소, 이름 등의 세부 정보 혼동
- 담화 구조상 핵심 정보 위치 파악 필요
`,

  'LC15': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 담화를 듣고 세부 정보 파악

### 개별 선택지 역할
① **정답**: 담화 내용과 정확히 일치
② **오답**: 부분적으로만 일치
③ **오답**: 담화의 다른 부분과 혼동
④ **오답**: 논리적으로 타당하지만 언급되지 않음
⑤ **오답**: 담화 내용과 반대

### 오답 매력도 확보 전략
- 긴 담화에서 핵심 정보 위치 파악 필요
- 세부 사항의 정확한 기억 필요
`,

  // LC16-17: 세트 문항
  'LC16_17': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙 (세트 문항)
- **각 문항 5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 긴 담화의 전체 내용 및 세부 정보 파악

### LC16 (첫 번째 문항) 역할
① **정답**: 담화의 주제/목적에 해당
② **오답**: 담화의 부차적 내용
③ **오답**: 담화에서 언급된 예시
④ **오답**: 관련 있지만 언급되지 않은 내용
⑤ **오답**: 담화 내용과 반대

### LC17 (두 번째 문항) 역할
① **정답**: 세부 정보와 정확히 일치
② **오답**: 담화의 다른 세부 정보
③ **오답**: 부분적으로만 일치
④ **오답**: 추론 가능하지만 직접 언급되지 않음
⑤ **오답**: 담화 내용과 불일치

### 오답 매력도 확보 전략
- 두 문항이 담화의 다른 측면을 측정
- 첫 문항: 전체 구조/목적, 두 번째 문항: 세부 정보
`,

  // ===== 세트 문항 =====

  'RC41_42': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙 (세트 문항)
- **각 문항 5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 장문 독해의 전체 이해 및 세부 파악

### RC41 (첫 번째 문항 - 주로 제목/주제)
① **정답**: 글 전체를 아우르는 제목/주제
② **오답**: 글의 일부분만 반영
③ **오답**: 너무 광범위한 제목/주제
④ **오답**: 글의 예시에만 집중
⑤ **오답**: 글의 논지와 다른 방향

### RC42 (두 번째 문항 - 세부 내용/어휘)
① **정답**: 세부 내용과 정확히 일치
② **오답**: 글의 다른 부분과 혼동
③ **오답**: 부분적으로만 일치
④ **오답**: 글에서 암시되지만 명시되지 않음
⑤ **오답**: 글 내용과 반대

### 오답 매력도 확보 전략
- 장문의 복잡한 구조 활용
- 두 문항이 서로 다른 읽기 능력 측정
`,

  'RC43_45': `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙 (세트 문항 - 3문항)
- **각 문항 5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 장문 독해의 다양한 측면 파악

### RC43 (순서 배열)
① **정답**: 논리적으로 올바른 (A)-(B)-(C) 순서
② **오답**: 첫 문단만 맞는 순서
③ **오답**: 마지막 문단만 맞는 순서
④ **오답**: 두 문단 순서가 바뀐 배열
⑤ **오답**: 완전히 잘못된 순서

### RC44 (문장 삽입 또는 지칭 추론)
① **정답**: 문맥상 올바른 위치/지칭 대상
② **오답**: 어휘적으로만 연결되는 위치/대상
③ **오답**: 주제적으로만 연결되는 위치/대상
④ **오답**: 부분적으로 연결되는 위치/대상
⑤ **오답**: 명백히 부적절한 위치/대상

### RC45 (내용 일치/불일치)
① **정답**: 글 내용과 정확히 일치/불일치
② **오답**: 세부 사항이 다른 선택지
③ **오답**: 글의 다른 부분과 혼동되는 선택지
④ **오답**: 추론 가능하지만 명시되지 않은 내용
⑤ **오답**: 글 내용과 반대

### 오답 매력도 확보 전략
- 3문항이 장문의 다양한 측면 측정
- 글 전체를 꼼꼼히 읽어야 모든 문항 해결 가능
`
};

// 기본 템플릿 (특정 지침이 없는 문항용)
const DEFAULT_TEMPLATE = `
## Distractor Design Guidelines (오답 설계 지침)

### 선택지 구성 원칙
- **5개 선택지**: 정답 1개 + 매력적 오답 4개
- **변별력**: 상위권 학생이 마지막까지 고민하도록 설계

### 개별 선택지 역할
① **정답**: 문항의 요구사항을 완벽히 충족
② **오답 (부분 일치)**: 일부 조건만 충족하는 선택지
③ **오답 (과잉 확대)**: 지문 범위를 넘어선 내용
④ **오답 (관련 혼동)**: 관련 있어 보이지만 정확하지 않은 내용
⑤ **오답 (반대/무관)**: 지문 내용과 상반되거나 무관한 내용

### 오답 매력도 확보 전략
- 모든 오답이 독립적으로 보면 의미 있는 내용
- 지문을 꼼꼼히 읽어야 정답과 오답 구분 가능
- 표면적 유사성이 아닌 논리적 연결성 기준으로 정답 판별
`;

async function main() {
  try {
    console.log('데이터베이스 초기화 중...');
    await initDatabase();

    const db = getDb();

    // 모든 문항 프롬프트 조회 (MASTER_PROMPT, PASSAGE 제외)
    const prompts = db.prepare(`
      SELECT id, prompt_key, prompt_text, title
      FROM prompts
      WHERE prompt_key NOT LIKE 'P%'
        AND prompt_key NOT IN ('MASTER_PROMPT', 'PASSAGE_MASTER')
        AND active = 1
    `).all();

    console.log(`\n총 ${prompts.length}개의 프롬프트를 처리합니다.\n`);

    let updated = 0;
    let skipped = 0;

    for (const prompt of prompts) {
      const { id, prompt_key, prompt_text, title } = prompt;

      // 이미 오답 설계 지침이 있는지 확인
      if (prompt_text.includes('Distractor Design Guidelines') ||
          prompt_text.includes('오답 설계 지침')) {
        console.log(`[SKIP] ${prompt_key}: 이미 오답 설계 지침이 있습니다.`);
        skipped++;
        continue;
      }

      // 해당 문항에 맞는 지침 선택
      let guideline = DISTRACTOR_GUIDELINES[prompt_key];

      // 정확한 키가 없으면 유사한 키 찾기
      if (!guideline) {
        // LC01 -> LC01, RC18 -> RC18 형태로 매칭
        for (const key of Object.keys(DISTRACTOR_GUIDELINES)) {
          if (prompt_key.includes(key) || key.includes(prompt_key)) {
            guideline = DISTRACTOR_GUIDELINES[key];
            break;
          }
        }
      }

      // 숫자 키 매칭 (1 -> LC01, 18 -> RC18 등)
      if (!guideline && /^\d+$/.test(prompt_key)) {
        const num = parseInt(prompt_key);
        if (num >= 1 && num <= 17) {
          guideline = DISTRACTOR_GUIDELINES[`LC${String(num).padStart(2, '0')}`];
        } else if (num >= 18 && num <= 45) {
          guideline = DISTRACTOR_GUIDELINES[`RC${num}`];
        }
      }

      // 그래도 없으면 기본 템플릿 사용
      if (!guideline) {
        guideline = DEFAULT_TEMPLATE;
        console.log(`[DEFAULT] ${prompt_key}: 기본 템플릿 적용`);
      } else {
        console.log(`[UPDATE] ${prompt_key}: 전용 지침 적용`);
      }

      // 프롬프트에 지침 추가
      const updatedText = prompt_text.trim() + '\n\n' + guideline.trim();

      // DB 업데이트
      db.prepare(`
        UPDATE prompts
        SET prompt_text = ?,
            updated_at = CURRENT_TIMESTAMP
        WHERE id = ?
      `).run(updatedText, id);

      updated++;
    }

    // 변경사항 저장
    saveDatabase();

    console.log('\n========================================');
    console.log(`완료: ${updated}개 업데이트, ${skipped}개 스킵`);
    console.log('========================================\n');

    closeDatabase();
    process.exit(0);

  } catch (error) {
    console.error('오류 발생:', error);
    process.exit(1);
  }
}

main();
