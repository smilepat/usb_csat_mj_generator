# 수능 영어 문항 자동 생성 시스템 - 작동방식 가이드

## 목차
1. [시스템 개요](#1-시스템-개요)
2. [시스템 구조](#2-시스템-구조)
3. [설치 및 실행](#3-설치-및-실행)
4. [문항 생성 흐름](#4-문항-생성-흐름)
5. [핵심 파일 설명](#5-핵심-파일-설명)
6. [데이터베이스 구조](#6-데이터베이스-구조)
7. [검증 시스템](#7-검증-시스템)
8. [세트 문항 처리](#8-세트-문항-처리)
9. [프롬프트 관리](#9-프롬프트-관리)
10. [문제 해결 가이드](#10-문제-해결-가이드)

---

## 1. 시스템 개요

### 1.1 시스템 목적
이 시스템은 수능 영어 영역 문항(1번~45번)을 AI(LLM)를 활용하여 자동으로 생성하는 웹 애플리케이션입니다.

### 1.2 주요 기능
- **문항 자동 생성**: 듣기(LC 1-17번) 및 독해(RC 18-45번) 문항 생성
- **지문 자동 생성**: 지문이 없을 경우 AI가 자동으로 지문 생성
- **3단계 검증**: 구조 검증 → 내용 품질 검증 → 수능 적합성 검증
- **세트 문항 지원**: 16-17번, 41-42번, 43-45번 세트 문항 처리
- **프롬프트 관리**: 문항 유형별 프롬프트 관리 및 버전 관리

### 1.3 기술 스택
| 구분 | 기술 |
|------|------|
| 백엔드 | Node.js + Express.js |
| 프론트엔드 | React 18 + React Router |
| 데이터베이스 | SQLite (sql.js) |
| AI API | Gemini API, OpenAI API, Azure OpenAI API |

### 1.4 포트 구성
- **서버(백엔드)**: 포트 3001
- **클라이언트(프론트엔드)**: 포트 3000

---

## 2. 시스템 구조

### 2.1 전체 아키텍처
```
┌─────────────────────────────────────────────────────────────────┐
│                        사용자 (웹 브라우저)                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    프론트엔드 (React, 포트 3000)                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ 문항생성  │  │ 프롬프트  │  │  세트    │  │  설정    │       │
│  │   페이지  │  │   관리   │  │   관리   │  │   페이지  │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼ HTTP API 호출
┌─────────────────────────────────────────────────────────────────┐
│                    백엔드 (Express.js, 포트 3001)                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                      라우트 (Routes)                      │  │
│  │  /api/items  /api/prompts  /api/sets  /api/config       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                │                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    서비스 (Services)                      │  │
│  │  itemPipeline │ promptBuilder │ llmClient │ validators   │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                                │
                    ┌───────────┴───────────┐
                    ▼                       ▼
            ┌─────────────┐         ┌─────────────┐
            │   SQLite    │         │   AI API    │
            │  데이터베이스 │         │ (Gemini 등) │
            └─────────────┘         └─────────────┘
```

### 2.2 디렉토리 구조
```
e:\usb_csat_mj_generator\
├── web-app/
│   ├── server/                    # 백엔드
│   │   ├── index.js               # 서버 진입점
│   │   ├── db/
│   │   │   └── database.js        # DB 초기화 및 스키마
│   │   ├── routes/                # API 라우트
│   │   │   ├── items.js           # 문항 API
│   │   │   ├── sets.js            # 세트 API
│   │   │   ├── prompts.js         # 프롬프트 API
│   │   │   └── config.js          # 설정 API
│   │   └── services/              # 비즈니스 로직
│   │       ├── itemPipeline.js    # 문항 생성 파이프라인
│   │       ├── promptBuilder.js   # 프롬프트 조합
│   │       ├── llmClient.js       # AI API 호출
│   │       ├── jsonUtils.js       # JSON 파싱/정규화
│   │       └── validators/        # 검증 모듈
│   │           ├── common.js      # 공통 검증
│   │           ├── grammar.js     # RC29 문법 검증
│   │           ├── gap.js         # RC31-34 빈칸 검증
│   │           ├── listening.js   # LC1-17 듣기 검증
│   │           ├── format.js      # 형식 검증
│   │           └── set.js         # 세트 검증
│   └── client/                    # 프론트엔드
│       └── src/
│           ├── pages/             # 페이지 컴포넌트
│           │   ├── ItemCreate.js  # 문항 생성
│           │   ├── Prompts.js     # 프롬프트 관리
│           │   └── Config.js      # 설정
│           └── api/
│               └── index.js       # API 클라이언트
├── data/
│   └── csat.db                    # SQLite 데이터베이스 파일
└── 작동방식.md                     # 이 문서
```

---

## 3. 설치 및 실행

### 3.1 사전 요구사항
- Node.js 18 이상
- npm 또는 yarn

### 3.2 설치 방법
```bash
# 1. 프로젝트 디렉토리로 이동
cd e:\usb_csat_mj_generator\web-app

# 2. 서버 의존성 설치
cd server
npm install

# 3. 클라이언트 의존성 설치
cd ../client
npm install
```

### 3.3 실행 방법
```bash
# 방법 1: 개별 실행
# 터미널 1 - 서버 실행
cd web-app/server
npm run dev

# 터미널 2 - 클라이언트 실행
cd web-app/client
npm start

# 방법 2: 동시 실행 (루트 디렉토리에서)
cd web-app
npm run dev  # 서버와 클라이언트 동시 실행
```

### 3.4 접속 방법
- 웹 브라우저에서 `http://localhost:3000` 접속

### 3.5 환경 변수 설정
서버의 `.env` 파일 또는 Config 페이지에서 설정:
```
GEMINI_API_KEY=your-api-key      # Gemini API 키
OPENAI_API_KEY=your-api-key      # OpenAI API 키 (선택)
PROVIDER=gemini                   # 사용할 AI 제공자
```

---

## 4. 문항 생성 흐름

### 4.1 단일 문항 생성 흐름
```
┌─────────────────────────────────────────────────────────────┐
│           사용자가 문항 번호, 난이도, 지문 입력                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [1단계] 지문 자동 생성 (지문이 비어있는 경우)                    │
│  - passageGenerator.js에서 지문 생성                         │
│  - PASSAGE_MASTER + P01~P45 프롬프트 사용                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [2단계] 프롬프트 조합                                        │
│  - MASTER_PROMPT (시스템 프롬프트)                           │
│  - LC01~LC17 또는 RC18~RC45 (문항 유형별 프롬프트)            │
│  - 사용자 입력값 (지문, 난이도, 추가 지시사항)                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [3단계] AI API 호출                                         │
│  - Gemini, OpenAI, 또는 Azure OpenAI 호출                   │
│  - 설정된 온도(temperature), 타임아웃 적용                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [4단계] JSON 파싱 및 정규화                                   │
│  - jsonUtils.js에서 응답 파싱                                │
│  - 원숫자(①②③④⑤)를 정수(1-5)로 변환                         │
│  - 다양한 필드명을 표준 형식으로 정규화                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [5단계] 3단계 검증                                          │
│  - Layer 1: 구조 검증 (필수 필드, 선택지 5개, 정답 1-5)        │
│  - Layer 2: 내용 품질 검증 (오답 품질, 정답 유일성)            │
│  - Layer 3: 수능 적합성 검증 (단어 수, 문장 복잡도)            │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                 검증 통과             검증 실패
                    │                   │
                    ▼                   ▼
             ┌───────────┐      ┌───────────────┐
             │ 결과 저장  │      │ 재시도 (최대 3회)│
             └───────────┘      └───────────────┘
```

### 4.2 세트 문항 생성 흐름
세트 문항(16-17, 41-42, 43-45)은 공통 지문을 공유하며 함께 생성됩니다:

```
┌─────────────────────────────────────────────────────────────┐
│         사용자가 세트 문항 번호 선택 (예: 43-45)                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [1단계] 세트 생성                                           │
│  - 고유 set_id 생성                                         │
│  - item_sets 테이블에 세트 정보 저장                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [2단계] 개별 문항 요청 추가                                   │
│  - 43번, 44번, 45번 각각의 요청 생성                          │
│  - 모두 동일한 set_id로 연결                                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [3단계] 병렬 생성 실행                                       │
│  - RC43_45 프롬프트로 공통 지문 + 3개 문항 동시 생성            │
│  - questions 배열 형식으로 응답                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  [4단계] 개별 문항 추출 및 저장                                │
│  - normalizeSetItemJson()으로 각 문항 분리                   │
│  - 43번, 44번, 45번 각각 저장                                │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 프롬프트 키 매핑
```
문항 번호 → 프롬프트 키 변환 규칙:

듣기 문항 (1-17번):
  1-15번  → LC01, LC02, ..., LC15
  16, 17번 → LC16_17 (세트)

독해 문항 (18-45번):
  18-40번 → RC18, RC19, ..., RC40
  41, 42번 → RC41_42 (세트)
  43, 44, 45번 → RC43_45 (세트)
```

---

## 5. 핵심 파일 설명

### 5.1 itemPipeline.js (문항 생성 파이프라인)
**위치**: `web-app/server/services/itemPipeline.js`

**주요 함수**:
| 함수명 | 설명 |
|--------|------|
| `generateItemPipeline(req)` | 단일 문항 생성 메인 함수 |
| `generateSetItems(setId)` | 세트 문항 생성 함수 |
| `saveItemResults(requestId, result)` | 생성 결과 저장 |

**처리 흐름**:
1. 지문 자동 생성 (필요시)
2. 프롬프트 조합
3. AI API 호출
4. JSON 파싱
5. 정규화
6. 검증 (공통 → 유형별 → 형식)
7. 결과 저장

### 5.2 promptBuilder.js (프롬프트 조합)
**위치**: `web-app/server/services/promptBuilder.js`

**주요 함수**:
| 함수명 | 설명 |
|--------|------|
| `buildPromptBundle(req)` | 시스템+사용자 프롬프트 조합 |
| `readMasterPrompt()` | MASTER_PROMPT 읽기 (캐시 5분) |
| `readItemPrompt(itemNo)` | 문항 유형별 프롬프트 읽기 |
| `itemNoToPromptKey(itemNo)` | 문항 번호 → 프롬프트 키 변환 |

**프롬프트 조합 예시**:
```
시스템 프롬프트 = MASTER_PROMPT
사용자 프롬프트 = RC29 프롬프트 + 지문 + 난이도 + 추가 지시사항
```

### 5.3 jsonUtils.js (JSON 처리)
**위치**: `web-app/server/services/jsonUtils.js`

**주요 함수**:
| 함수명 | 설명 |
|--------|------|
| `parseItemJson(rawText)` | LLM 응답에서 JSON 추출 |
| `normalizeItemJson(obj, targetItemNo)` | JSON 정규화 |
| `normalizeSetItemJson(obj, targetItemNo)` | 세트 응답 정규화 |

**JSON 정규화 예시**:
```javascript
// LLM 응답의 다양한 형식을 표준 형식으로 변환
{
  correct_answer: ①  →  answer: "1"
  question_stem: "..."  →  question: "..."
  stimulus: "..."  →  passage: "..."
}
```

### 5.4 llmClient.js (AI API 호출)
**위치**: `web-app/server/services/llmClient.js`

**지원 제공자**:
- Gemini (기본)
- OpenAI
- Azure OpenAI

**주요 함수**:
| 함수명 | 설명 |
|--------|------|
| `callLLM(systemPrompt, userPrompt)` | 통합 API 호출 |
| `callGemini()` | Gemini API 호출 |
| `callOpenAI()` | OpenAI API 호출 |
| `callAzureOpenAI()` | Azure OpenAI API 호출 |

### 5.5 ItemCreate.js (문항 생성 페이지)
**위치**: `web-app/client/src/pages/ItemCreate.js`

**주요 기능**:
- 문항 번호, 난이도, 지문 입력 폼
- 세트 문항 감지 및 처리
- 프롬프트 미리보기
- 생성 결과 표시

**세트 문항 처리 로직**:
```javascript
// 세트 문항 번호 감지
const isSetItemNo = (itemNo) => {
  return ['16-17', '41-42', '43-45'].includes(String(itemNo));
};

// 세트 문항이면 setsApi 사용
if (isSetItemNo(formData.item_no)) {
  await handleSetItemGeneration();
}
```

---

## 6. 데이터베이스 구조

### 6.1 핵심 테이블

#### item_requests (문항 생성 요청)
```sql
CREATE TABLE item_requests (
  request_id TEXT PRIMARY KEY,      -- 요청 고유 ID
  status TEXT DEFAULT 'PENDING',    -- 상태: PENDING/RUNNING/OK/FAIL
  item_no INTEGER,                  -- 문항 번호 (1-45)
  passage TEXT,                     -- 지문
  level TEXT,                       -- 난이도 (하/중하/중/중상/상)
  extra TEXT,                       -- 추가 지시사항
  set_id TEXT,                      -- 세트 ID (세트 문항인 경우)
  created_at TEXT,
  updated_at TEXT
);
```

#### item_output (생성된 문항)
```sql
CREATE TABLE item_output (
  id INTEGER PRIMARY KEY,
  request_id TEXT,                  -- 요청 ID (FK)
  item_no INTEGER,                  -- 문항 번호
  question TEXT,                    -- 발문
  option_1 ~ option_5 TEXT,         -- 선택지 1-5
  answer TEXT,                      -- 정답 (1-5)
  explanation TEXT,                 -- 해설
  created_at TEXT
);
```

#### item_sets (세트 정보)
```sql
CREATE TABLE item_sets (
  set_id TEXT PRIMARY KEY,          -- 세트 고유 ID
  set_name TEXT,                    -- 세트 이름
  common_passage TEXT,              -- 공통 지문
  profile TEXT,                     -- 난이도 프로필
  created_at TEXT,
  updated_at TEXT
);
```

#### prompts (프롬프트)
```sql
CREATE TABLE prompts (
  id INTEGER PRIMARY KEY,
  prompt_key TEXT UNIQUE,           -- 프롬프트 키 (예: RC29, LC16_17)
  title TEXT,                       -- 제목
  prompt_text TEXT,                 -- 프롬프트 내용
  is_default INTEGER DEFAULT 1,    -- 기본 프롬프트 여부
  created_at TEXT,
  updated_at TEXT
);
```

### 6.2 주요 프롬프트 키
| 프롬프트 키 | 설명 |
|-------------|------|
| `MASTER_PROMPT` | 시스템 레벨 기본 지시사항 |
| `PASSAGE_MASTER` | 지문 생성용 마스터 프롬프트 |
| `LC01` ~ `LC15` | 듣기 개별 문항 프롬프트 |
| `LC16_17` | 듣기 세트 문항 프롬프트 |
| `RC18` ~ `RC40` | 독해 개별 문항 프롬프트 |
| `RC41_42` | 독해 세트 문항 프롬프트 (2문항) |
| `RC43_45` | 독해 세트 문항 프롬프트 (3문항) |
| `P01` ~ `P45` | 지문 생성용 프롬프트 |

---

## 7. 검증 시스템

### 7.1 3계층 검증 구조

```
┌─────────────────────────────────────────────────────────────┐
│   Layer 1: 구조 검증 (필수, Pass/Fail)                        │
├─────────────────────────────────────────────────────────────┤
│ • 필수 필드 존재 여부 (question, options, answer, passage)    │
│ • 선택지 배열 길이 = 5                                        │
│ • 정답 범위 1-5                                              │
│ • JSON 스키마 준수                                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│   Layer 2: 내용 품질 검증 (점수화)                            │
├─────────────────────────────────────────────────────────────┤
│ • 정답이 선택지에 포함되어 있는지                              │
│ • 오답(매력적 오답)의 품질                                    │
│ • 지문-정답 중복 분석                                        │
│ • 복수 정답 위험 감지                                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│   Layer 3: 수능 적합성 검증 (점수화)                          │
├─────────────────────────────────────────────────────────────┤
│ • 단어 수 (문항 유형별 기준)                                  │
│ • 문장 복잡도 (평균 12-28 단어/문장)                          │
│ • 언어 일관성 (영어 지문 + 영어 선택지)                        │
│ • 형식 요구사항                                              │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 문항 유형별 검증

#### RC29 (문법 - 밑줄 유형)
**파일**: `validators/grammar.js`
```
검증 항목:
• 정확히 5개의 밑줄 친 부분 존재
• 그 중 정확히 1개만 문법적으로 틀림
• 지원 형식: <u>...</u>, **...**, __...__
```

#### RC31-34 (빈칸 채우기)
**파일**: `validators/gap.js`
```
검증 항목:
• 정확히 1개의 빈칸 존재
• 빈칸 형식: (___) 또는 ____
• 중복 빈칸 없음
```

#### LC1-17 (듣기)
**파일**: `validators/listening.js`
```
검증 항목:
• 화자 표시 (M:, W:, Man:, Woman:)
• 스크립트 길이 (유형별 기준)
• 화자 전환 횟수
• LC6: 숫자 선택지 검증
• LC4: 이미지 프롬프트 필요
```

#### 세트 문항 (16-17, 41-42, 43-45)
**파일**: `validators/set.js`
```
검증 항목:
• 허용된 패턴인지 (16-17, 41-42, 43-45만 허용)
• 범위 내 모든 문항 존재
• 공통 지문 일관성
```

### 7.3 등급 기준
```
최종 점수 = Layer 1 + Layer 2 + Layer 3 가중 합산

등급:
  A (90-100점): APPROVE - 승인
  B (80-89점):  APPROVE - 승인
  C (70-79점):  REVIEW  - 검토 필요
  D (60-69점):  REVIEW  - 검토 필요
  F (60점 미만): REJECT  - 거부
```

---

## 8. 세트 문항 처리

### 8.1 허용된 세트 패턴
| 패턴 | 문항 번호 | 유형 |
|------|-----------|------|
| 16-17 | 16번, 17번 | 듣기 (LC) |
| 41-42 | 41번, 42번 | 독해 (RC) |
| 43-45 | 43번, 44번, 45번 | 독해 (RC) |

### 8.2 세트 문항 생성 API 흐름

```javascript
// 1. 세트 생성
await setsApi.create({
  set_id: 'SET_43_45_1234567890',
  set_name: '43-45번 세트',
  common_passage: '',
  profile: '43:중,44:중,45:상'
});

// 2. 개별 문항 요청 추가
await setsApi.addRequests(setId, [
  { item_no: 43, level: '중' },
  { item_no: 44, level: '중' },
  { item_no: 45, level: '상' }
]);

// 3. 세트 생성 실행
await setsApi.generate(setId);
```

### 8.3 세트 응답 JSON 형식
```json
{
  "stimulus": "공통 지문...",
  "set_instruction": "다음 글을 읽고, 물음에 답하시오.",
  "questions": [
    {
      "question_number": 43,
      "question": "43번 발문...",
      "options": ["선택지1", "선택지2", "선택지3", "선택지4", "선택지5"],
      "correct_answer": 3,
      "explanation": "해설..."
    },
    {
      "question_number": 44,
      "question": "44번 발문...",
      "options": [...],
      "correct_answer": 2,
      "explanation": "..."
    },
    {
      "question_number": 45,
      "question": "45번 발문...",
      "options": [...],
      "correct_answer": 4,
      "explanation": "..."
    }
  ]
}
```

### 8.4 세트 응답 정규화
`normalizeSetItemJson()` 함수가 세트 응답에서 개별 문항을 추출합니다:

```javascript
// questions 배열에서 targetItemNo에 해당하는 문항 추출
function normalizeSetItemJson(obj, targetItemNo) {
  // targetItemNo로 해당 문항 찾기
  const targetQuestion = obj.questions.find(q =>
    q.question_number === targetItemNo
  );

  // 개별 문항 형식으로 변환하여 반환
  return {
    itemNo: targetQuestion.question_number,
    question: targetQuestion.question,
    options: targetQuestion.options,
    answer: targetQuestion.correct_answer,
    passage: obj.stimulus,
    ...
  };
}
```

---

## 9. 프롬프트 관리

### 9.1 프롬프트 구조
```
MASTER_PROMPT (시스템 프롬프트)
     +
문항 유형별 프롬프트 (LC01, RC29 등)
     +
사용자 입력 (지문, 난이도, 추가 지시사항)
     ↓
최종 프롬프트 조합
```

### 9.2 프롬프트 키 명명 규칙
```
듣기: LC + 2자리 번호
  LC01, LC02, ..., LC15
  LC16_17 (세트)

독해: RC + 번호
  RC18, RC19, ..., RC40
  RC41_42 (세트)
  RC43_45 (세트)

지문 생성: P + 2자리 번호
  P01, P02, ..., P45

시스템:
  MASTER_PROMPT
  PASSAGE_MASTER
```

### 9.3 프롬프트 캐싱
- 캐시 TTL: 5분
- 프롬프트 수정 시 자동 무효화
- DB 읽기 최소화로 성능 향상

### 9.4 프롬프트 버전 관리
- 수정 시 자동 버전 생성
- prompt_versions 테이블에 이력 저장
- 변경 사유 기록 가능

---

## 10. 문제 해결 가이드

### 10.1 자주 발생하는 오류

#### 오류: "JSON.parse 실패: Unexpected token '①'"
**원인**: LLM이 정답을 원숫자(①②③④⑤)로 반환
**해결**: `jsonUtils.js`에서 자동 변환 처리됨 (최신 버전)

#### 오류: "options 배열이 없습니다"
**원인**: 세트 문항의 응답 형식이 `questions` 배열 형식임
**해결**: `normalizeSetItemJson()` 함수가 자동 처리

#### 오류: "ITEM_NO=43-45에 해당하는 프롬프트를 찾을 수 없습니다"
**원인**: 세트 문항 번호 형식("43-45")이 프롬프트 키("RC43_45")로 변환되지 않음
**해결**: `itemNoToPromptKey()` 함수에서 자동 변환 처리됨

#### 오류: "세트 문항인데 43번만 생성됨"
**원인**: 단일 문항 API 사용
**해결**: `ItemCreate.js`에서 세트 문항 감지 후 `setsApi` 사용

### 10.2 로그 확인 방법
```bash
# 서버 콘솔에서 실시간 로그 확인
# 또는 웹 UI의 로그 페이지에서 확인

# 주요 로그 태그:
[itemPipeline] - 문항 생성 파이프라인
[promptBuilder] - 프롬프트 조합
[jsonUtils] - JSON 파싱/정규화
[validator] - 검증 결과
```

### 10.3 디버깅 팁

1. **프롬프트 미리보기 사용**
   - 문항 생성 전 "프롬프트 미리보기" 버튼으로 확인
   - 조합된 프롬프트 내용 검토

2. **생성 이력 확인**
   - `item_generation_history` 테이블에서 모든 시도 기록 확인
   - 실패 원인 분석

3. **검증 로그 확인**
   - 결과 화면에서 "검증 로그" 섹션 확인
   - Layer별 점수 및 실패 원인 확인

### 10.4 설정 조정

| 설정 | 기본값 | 설명 |
|------|--------|------|
| PROVIDER | gemini | AI 제공자 (gemini/openai/azure) |
| TEMP_BASE | 0.4 | 기본 온도 (낮을수록 일관성) |
| MAX_RETRY | 3 | 최대 재시도 횟수 |
| TIMEOUT_MS | 60000 | API 타임아웃 (밀리초) |

---

## 부록: API 엔드포인트 요약

### 문항 API (`/api/items`)
| 메소드 | 경로 | 설명 |
|--------|------|------|
| POST | /requests | 문항 요청 생성 |
| POST | /generate/:id | 단일 문항 생성 |
| GET | /requests/:id | 요청 상세 조회 |
| GET | /outputs/:requestId | 생성 결과 조회 |

### 세트 API (`/api/sets`)
| 메소드 | 경로 | 설명 |
|--------|------|------|
| POST | / | 세트 생성 |
| POST | /:setId/requests | 세트에 문항 추가 |
| POST | /:setId/generate | 세트 문항 생성 |
| GET | /:setId | 세트 상세 조회 |

### 프롬프트 API (`/api/prompts`)
| 메소드 | 경로 | 설명 |
|--------|------|------|
| GET | / | 프롬프트 목록 |
| GET | /:key | 프롬프트 조회 |
| PUT | /:key | 프롬프트 수정 |

### 설정 API (`/api/config`)
| 메소드 | 경로 | 설명 |
|--------|------|------|
| GET | / | 전체 설정 조회 |
| PUT | /:key | 설정 수정 |

---

*문서 작성일: 2026-01-22*
*버전: 1.0*
